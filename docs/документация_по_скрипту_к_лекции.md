# Скрипты для создания и привязки лекций

Это общий план скриптов. Все они пишутся на TypeScript + Prisma.

## 1. Основной скрипт: create-lecture-and-link.ts

Назначение:

- Принимает название теста, название лекции и путь к файлу с Markdown-контентом
- Находит тест
- Создаёт лекцию
- Привязывает лекцию ко всем вопросам теста

```ts
// scripts/create-lecture-and-link.ts

import { PrismaClient } from "@prisma/client";
import fs from "fs/promises";
import path from "path";
import dotenv from "dotenv";

dotenv.config();

const prisma = new PrismaClient();

async function main() {
  const testTitle = process.argv[2]; // "HTTP методы: основы"
  const lectureTitle = process.argv[3]; // "HTTP методы: основы"
  const contentFile = process.argv[4]; // "./lectures/http-methods-basics.md"

  if (!testTitle || !lectureTitle || !contentFile) {
    console.error(
      'Использование: npx tsx create-lecture-and-link.ts "Название теста" "Название лекции" "путь/к/файлу.md"',
    );
    process.exit(1);
  }

  let content: string;
  try {
    content = await fs.readFile(path.resolve(contentFile), "utf-8");
  } catch (err) {
    console.error(`Не удалось прочитать файл: ${contentFile}`);
    process.exit(1);
  }

  try {
    // Находим тест
    const test = await prisma.test.findFirst({
      where: { title: testTitle },
      include: {
        questions: {
          include: { question: true },
          orderBy: { order: "asc" },
        },
      },
    });

    if (!test) throw new Error(`Тест "${testTitle}" не найден`);

    console.log(
      `Найден тест "${test.title}" с ${test.questions.length} вопросами`,
    );

    // Создаём лекцию
    const lecture = await prisma.lecture.create({
      data: {
        title: lectureTitle,
        topic: test.topic || "Не указана",
        content,
      },
    });

    console.log(`Лекция создана: ${lecture.title} (ID: ${lecture.id})`);

    // Привязываем ко всем вопросам
    for (const tq of test.questions) {
      await prisma.question.update({
        where: { id: tq.questionId },
        data: { lectureId: lecture.id },
      });
    }

    console.log(`Лекция привязана к ${test.questions.length} вопросам`);
  } catch (error) {
    console.error("Ошибка:", error);
    process.exit(1);
  } finally {
    await prisma.$disconnect();
  }
}

main();
```
