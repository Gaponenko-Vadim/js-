import { PrismaClient } from '@prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';
import { Pool } from 'pg';
import dotenv from 'dotenv';

dotenv.config();

const pool = new Pool({ connectionString: process.env.DATABASE_URL });
const adapter = new PrismaPg(pool);
const prisma = new PrismaClient({ adapter });

function cleanContent(content: string): string {
  return content
    .replace(/\0/g, '')
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g, '');
}

const lectureContentRaw = `
# –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API

## –í–≤–µ–¥–µ–Ω–∏–µ

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –≤—ã–ø—É—Å—Ç–∏–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å 100,000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü –≤–∞–º –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤ API —Å \`"2024-01-15"\` –Ω–∞ \`"15.01.2024"\`. –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å API - –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å–ª–æ–º–∞—é—Ç—Å—è, –∏ 100K –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–≤–∏–¥—è—Ç –∫—Ä—ç—à. –ò–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å API –±–µ–∑ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

## –ó–∞—á–µ–º –Ω—É–∂–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?

### –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

1. **Breaking changes = —Å–ª–æ–º–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã**
   - –ò–∑–º–µ–Ω–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ ‚Üí —Å—Ç–∞—Ä—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫—Ä–∞—à–∞—Ç—Å—è
   - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ –ø–æ–ª–µ ‚Üí –∫–æ–¥ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –£–¥–∞–ª–∏–ª–∏ endpoint ‚Üí 404 –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

2. **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–≤–æ–ª—é—Ü–∏–∏**
   - –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å legacy —Ñ–æ—Ä–º–∞—Ç—ã –≤–µ—á–Ω–æ
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è
   - –ù–µ–ª—å–∑—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏

3. **–í—ã–Ω—É–∂–¥–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –ó–∞–ø—É—Ç–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ "–µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π –∫–ª–∏–µ–Ω—Ç, —Ç–æ..."
   - –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ legacy —Ö–∞–∫–∏

### –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é?

‚úÖ **Breaking changes (–Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è):**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—è (\`age: "25"\` ‚Üí \`age: 25\`)
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ –æ—Ç–≤–µ—Ç–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ URL —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ (–æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–∞–µ—Ç –¥—Ä—É–≥–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å –∫–æ–¥–æ–≤ –∏–ª–∏ error —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

‚ùå **–ù–ï —Ç—Ä–µ–±—É—é—Ç –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ (backwards compatible):**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –æ—Ç–≤–µ—Ç (—Å—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏—Ö –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö endpoints
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- Bug fixes –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- Performance improvements

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. URI Versioning (—Å–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –í–µ—Ä—Å–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ URL –ø—É—Ç–∏.

#### –í–∞—Ä–∏–∞–Ω—Ç—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞

**A) –í–µ—Ä—Å–∏—è –ø–µ—Ä–µ–¥ —Ä–µ—Å—É—Ä—Å–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
\`\`\`
GET /v1/users
GET /v2/users
GET /api/v1/users
\`\`\`

**B) –í–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞):**
\`\`\`
GET /api/v1/users
GET /api/v2/users
\`\`\`

‚ùå **–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
\`\`\`
GET /users/v1    # –í–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ —Ä–µ—Å—É—Ä—Å–∞ - –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ
GET /v1/api/users # –í–µ—Ä—Å–∏—è –ø–µ—Ä–µ–¥ /api - –ø—É—Ç–∞–Ω–∏—Ü–∞
\`\`\`

#### –ü–ª—é—Å—ã URI versioning

‚úÖ **–Ø–≤–Ω–æ—Å—Ç—å** - –≤–µ—Ä—Å–∏—è –≤–∏–¥–Ω–∞ –ø—Ä—è–º–æ –≤ URL
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–∞–∑–Ω—ã–µ URL = —Ä–∞–∑–Ω—ã–µ –∫–µ—à –∫–ª—é—á–∏
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ—á–µ–≤–∏–¥–Ω–∞—è –≤–µ—Ä—Å–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚úÖ **Routing** - –ª–µ–≥–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

#### –ú–∏–Ω—É—Å—ã

‚ùå **–ù–∞—Ä—É—à–∞–µ—Ç REST** - –≤–µ—Ä—Å–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Ä–µ—Å—É—Ä—Å–∞
‚ùå **URL pollution** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö endpoints
‚ùå **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - –∫–∞–∂–¥–∞—è –≤–µ—Ä—Å–∏—è —Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤—ã–π –∫–æ–¥

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –ü—É–±–ª–∏—á–Ω—ã–µ API (GitHub, Stripe, Twitter)
- Mobile/SPA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- API —Å –¥–æ–ª–≥–∏–º lifecycle –≤–µ—Ä—Å–∏–π

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** GitHub API, Stripe, Twitter, Google Cloud Platform.

---

### 2. Header Versioning (Content Negotiation)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –í–µ—Ä—Å–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö.

#### Accept Header (Media Type Versioning)

\`\`\`
GET /users
Accept: application/vnd.myapi.v1+json

GET /users
Accept: application/vnd.myapi.v2+json
\`\`\`

**Vendor Media Type —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
\`\`\`
application/vnd.{vendor}.{version}+{format}
application/vnd.github.v3+json
application/vnd.stripe.v2023-10+json
\`\`\`

#### Custom Header

\`\`\`
GET /users
X-API-Version: 1

GET /users
X-API-Version: 2
\`\`\`

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:
- \`API-Version: 1\`
- \`Accept-Version: 1\`

#### –ü–ª—é—Å—ã Header versioning

‚úÖ **RESTful** - —á–∏—Å—Ç—ã–µ URL, –≤–µ—Ä—Å–∏—è –∫–∞–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ endpoints
‚úÖ **–ß–∏—Å—Ç–æ—Ç–∞ URL** - \`/users\` –≤–º–µ—Å—Ç–æ \`/v1/users\`

#### –ú–∏–Ω—É—Å—ã

‚ùå **–°–ª–æ–∂–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –Ω—É–∂–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (curl, Postman)
‚ùå **–ú–µ–Ω–µ–µ –æ—á–µ–≤–∏–¥–Ω–æ** - –≤–µ—Ä—Å–∏—è –Ω–µ –≤–∏–¥–Ω–∞ –≤ URL
‚ùå **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–µ–µ** - –Ω—É–∂–µ–Ω \`Vary: Accept\` –∑–∞–≥–æ–ª–æ–≤–æ–∫
‚ùå **–ü—Ä–æ–±–ª–µ–º—ã —Å –±—Ä–∞—É–∑–µ—Ä–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º**

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- Internal API –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è REST –∏–¥–µ–æ–ª–æ–≥–∏–∏

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** Azure API Management, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ enterprise API.

---

### 3. Query Parameter Versioning

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –í–µ—Ä—Å–∏—è –∫–∞–∫ query –ø–∞—Ä–∞–º–µ—Ç—Ä.

\`\`\`
GET /users?version=1
GET /users?v=2
GET /users?api-version=2024-01
\`\`\`

#### –ü–ª—é—Å—ã

‚úÖ **–ü—Ä–æ—Å—Ç–æ** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –∫ –ª—é–±–æ–º—É URL
‚úÖ **–í–∏–¥–∏–º–æ** - –≤–µ—Ä—Å–∏—è –≤ URL (–∫–∞–∫ –∏ URI versioning)

#### –ú–∏–Ω—É—Å—ã

‚ùå **–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏**
‚ùå **–ü—É—Ç–∞–Ω–∏—Ü–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π** - \`?version=1\` –ø–æ—Ö–æ–∂ –Ω–∞ —Ñ–∏–ª—å—Ç—Ä
‚ùå **–õ–µ–≥–∫–æ –∑–∞–±—ã—Ç—å** - –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –Ω–µ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
‚ùå **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–ª–æ–∂–Ω–µ–µ —á–µ–º URI, –ø—Ä–æ—â–µ —á–µ–º headers

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–ü–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞. URI versioning –ª—É—á—à–µ –¥–ª—è —Ç–µ—Ö –∂–µ —Ü–µ–ª–µ–π.

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** Netflix API (legacy), –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞—Ä—ã–µ API.

---

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –≤–µ—Ä—Å–∏–π

### 1. Semantic Versioning (SemVer)

**–§–æ—Ä–º–∞—Ç:** \`MAJOR.MINOR.PATCH\` (1.2.3)

\`\`\`
MAJOR: breaking changes (1.0 ‚Üí 2.0)
MINOR: –Ω–æ–≤—ã–µ —Ñ–∏—á–∏, backwards compatible (1.0 ‚Üí 1.1)
PATCH: bug fixes (1.0.0 ‚Üí 1.0.1)
\`\`\`

**–ü—Ä–∏–º–µ—Ä—ã:**
\`\`\`
v1.0.0 - –ø–µ—Ä–≤–∞—è stable –≤–µ—Ä—Å–∏—è
v1.1.0 - –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π endpoint
v1.1.1 - –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –±–∞–≥ –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
v2.0.0 - –∏–∑–º–µ–Ω–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É JSON –æ—Ç–≤–µ—Ç–∞ (breaking)
\`\`\`

#### –ü–ª—é—Å—ã SemVer

‚úÖ **Semantic meaning** - –∫–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚úÖ **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** - –æ—Ç–ª–∏—á–∞—é—Ç—Å—è breaking, features, fixes
‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç** - –ø–æ–Ω—è—Ç–µ–Ω –≤—Å–µ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º

#### –ú–∏–Ω—É—Å—ã

‚ùå **–ò–∑–ª–∏—à–Ω—è—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è REST API**
‚ùå **–ß–∞—Å—Ç—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏** - –∫–∞–∂–¥—ã–π bug fix = –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- SDK –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- Internal API —Å —á–∞—Å—Ç—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** npm packages, Kubernetes API, OpenAPI Specification.

---

### 2. Integer Versioning (–ø—Ä–æ—Å—Ç–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è)

**–§–æ—Ä–º–∞—Ç:** \`v1\`, \`v2\`, \`v3\`

\`\`\`
GET /v1/users
GET /v2/users
GET /v3/users
\`\`\`

#### –ü–ª—é—Å—ã

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
‚úÖ **Stable versions** - –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ, —Ç–æ–ª—å–∫–æ –ø—Ä–∏ breaking changes
‚úÖ **–ß–∏—Å—Ç—ã–µ URL** - –∫–æ—Ä–æ—Ç–∫–∏–µ –∏ —á–∏—Ç–∞–µ–º—ã–µ

#### –ú–∏–Ω—É—Å—ã

‚ùå **–ù–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫–∏** - –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –º–µ–∂–¥—É v1 –∏ v2
‚ùå **–ù–µ–ª—å–∑—è –æ—Ç–ª–∏—á–∏—Ç—å** minor update –æ—Ç major

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –ü—É–±–ª–∏—á–Ω—ã–µ REST API —Å —Ä–µ–¥–∫–∏–º–∏ breaking changes
- –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- SPA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** GitHub API (v3), Stripe (v1), Twitter API (v2).

---

### 3. Calendar Versioning (CalVer)

**–§–æ—Ä–º–∞—Ç:** \`YYYY-MM\` –∏–ª–∏ \`YYYY.MM\`

\`\`\`
GET /v2024-01/users
GET /v2024.11/users
Accept: application/vnd.myapi.2024-01+json
\`\`\`

#### –ü—Ä–∏–º–µ—Ä—ã

\`\`\`
/v2024-01/users  # –Ø–Ω–≤–∞—Ä—å 2024
/v2024-12/users  # –î–µ–∫–∞–±—Ä—å 2024
/v2025-01/users  # –Ø–Ω–≤–∞—Ä—å 2025
\`\`\`

#### –ü–ª—é—Å—ã

‚úÖ **Time-based** - –ø–æ–Ω—è—Ç–Ω–æ –∫–æ–≥–¥–∞ –≤–µ—Ä—Å–∏—è –≤—ã–ø—É—â–µ–Ω–∞
‚úÖ **Predictable** - –∫–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç —á—Ç–æ –≤–µ—Ä—Å–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏

#### –ú–∏–Ω—É—Å—ã

‚ùå **–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç breaking changes** - 2024-01 –º–æ–∂–µ—Ç –±—ã—Ç—å compatible —Å 2023-12, –∞ –º–æ–∂–µ—Ç –Ω–µ—Ç
‚ùå **–ß–∞—Å—Ç—ã–µ –≤–µ—Ä—Å–∏–∏** - –Ω—É–∂–Ω–æ –≤—ã–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü/–≥–æ–¥?

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- API —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ —Ä–µ–ª–∏–∑–∞–º–∏
- Enterprise API —Å SLA
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** Ubuntu (YY.MM), Stripe (YYYY-MM-DD), –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ API.

---

### 4. –ù–∞—á–∏–Ω–∞—Ç—å —Å v0 –∏–ª–∏ v1?

**v1 - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production:**
\`\`\`
GET /v1/users  # –ü–µ—Ä–≤–∞—è stable –≤–µ—Ä—Å–∏—è
\`\`\`

**v0 - –î–ª—è –∞–ª—å—Ñ–∞/–±–µ—Ç–∞:**
\`\`\`
GET /v0/users  # –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π API, breaking changes –≤–æ–∑–º–æ–∂–Ω—ã
\`\`\`

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è beta:**
\`\`\`
GET /v1.0.0-alpha/users
GET /v1.0.0-beta/users
\`\`\`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å \`v1\` –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ API. \`v0\` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–ø—É–≥–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤–µ—Ä—Å–∏–π

### 1. Deprecation Policy (–ø–ª–∞–Ω —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏—è)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –û–±—ä—è–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –∑–∞—Ä–∞–Ω–µ–µ, –¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º –≤—Ä–µ–º—è –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å.

#### Deprecation –∑–∞–≥–æ–ª–æ–≤–æ–∫

\`\`\`
HTTP/1.1 200 OK
Deprecation: true
Deprecation: Tue, 01 Jan 2025 00:00:00 GMT
Link: <https://api.example.com/docs/migration-v1-to-v2>; rel="deprecation"
Warning: 299 - "API v1 is deprecated. Migrate to v2 by 2025-01-01"
\`\`\`

**RFC 8594 Deprecation Header:**
\`\`\`
Deprecation: @1735689600  # Unix timestamp
Deprecation: Sat, 01 Jan 2025 00:00:00 GMT
\`\`\`

#### –í response body

\`\`\`json
{
  "data": [...],
  "deprecated": true,
  "deprecation_date": "2025-01-01",
  "migration_guide": "https://docs.example.com/migration-v2"
}
\`\`\`

### 2. Sunset Policy (–ø–ª–∞–Ω –æ—Ç–∫–ª—é—á–µ–Ω–∏—è)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –û–±—ä—è–≤–∏—Ç—å –¥–∞—Ç—É –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏.

#### Sunset –∑–∞–≥–æ–ª–æ–≤–æ–∫ (RFC 8594)

\`\`\`
HTTP/1.1 200 OK
Sunset: Sat, 31 Dec 2025 23:59:59 GMT
Link: <https://api.example.com/v2/users>; rel="alternate"
\`\`\`

**–ó–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ —ç—Ç–æ–π –¥–∞—Ç—ã API –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

#### Timeline –ø—Ä–∏–º–µ—Ä

\`\`\`
2024-01-01: v2 –≤—ã–ø—É—â–µ–Ω
2024-06-01: v1 –æ–±—ä—è–≤–ª–µ–Ω deprecated (Deprecation –∑–∞–≥–æ–ª–æ–≤–æ–∫)
2025-01-01: v1 –æ–±—ä—è–≤–ª–µ–Ω sunset (Sunset –∑–∞–≥–æ–ª–æ–≤–æ–∫)
2025-06-01: v1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–µ–Ω (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 410 Gone)
\`\`\`

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è:**
- Deprecation ‚Üí Sunset: –º–∏–Ω–∏–º—É–º 6 –º–µ—Å—è—Ü–µ–≤
- Enterprise API: 12-24 –º–µ—Å—è—Ü–∞
- Internal API: 3-6 –º–µ—Å—è—Ü–µ–≤

### 3. –°–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ú–∏–Ω–∏–º—É–º 2 –≤–µ—Ä—Å–∏–∏ (current + previous).

\`\`\`
v3: Current, –∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
v2: Supported, –ø–æ–ª—É—á–∞–µ—Ç bug fixes
v1: Deprecated, —Ç–æ–ª—å–∫–æ security patches
v0: Sunset, –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞
\`\`\`

**–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- –ö–∞–∂–¥–∞—è –≤–µ—Ä—Å–∏—è = –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ë–æ–ª—å—à–µ –≤–µ—Ä—Å–∏–π = –±–æ–ª—å—à–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É UX (–¥–æ–ª–≥–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞) –∏ costs (–º–µ–Ω—å—à–µ –≤–µ—Ä—Å–∏–π)

### 4. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ internal API

‚ùì **–í–æ–ø—Ä–æ—Å:** –ù—É–∂–Ω–æ –ª–∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å API –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏?

**–û—Ç–≤–µ—Ç:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–¥—Ö–æ–¥–∞:

**A) Consumer-Driven Contracts:**
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pact, Spring Cloud Contract

**B) –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
- –î–∞, –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π—Ç–µ –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã–µ API
- –ó–∞—â–∏—Ç–∞ –æ—Ç breaking changes

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ evolutionary design –≤–º–µ—Å—Ç–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–º. –Ω–∏–∂–µ).

---

## Evolutionary API Design (—ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –†–∞–∑–≤–∏–≤–∞—Ç—å API –±–µ–∑ breaking changes, –∏–∑–±–µ–≥–∞—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

#### 1. Additive changes only

‚úÖ **–ú–æ–∂–Ω–æ:**
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ endpoints
- –î–æ–±–∞–≤–ª—è—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

‚ùå **–ù–µ–ª—å–∑—è:**
- –£–¥–∞–ª—è—Ç—å –ø–æ–ª—è
- –ò–∑–º–µ–Ω—è—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –ú–µ–Ω—è—Ç—å —Å–µ–º–∞–Ω—Ç–∏–∫—É

#### 2. Ignore unknown fields

–ö–ª–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–ª—è:
\`\`\`json
{
  "id": 1,
  "name": "John",
  "new_field_added_in_v2": "value"  // –°—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç
}
\`\`\`

#### 3. Optional parameters everywhere

\`\`\`javascript
// –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
GET /users?include_archived=true

// –°—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (default)
GET /users  # –ë–µ–∑ –∞—Ä—Ö–∏–≤–Ω—ã—Ö
\`\`\`

#### 4. Expand-Contract pattern

**–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—è:**

**Phase 1: Expand (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ)**
\`\`\`json
{
  "username": "john",        // –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ
  "user_name": "john"        // –ù–æ–≤–æ–µ –ø–æ–ª–µ (–¥—É–±–ª–∏–∫–∞—Ç)
}
\`\`\`

**Phase 2: Migrate clients**
–ö–ª–∏–µ–Ω—Ç—ã –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ \`user_name\`.

**Phase 3: Contract (—É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ)**
\`\`\`json
{
  "user_name": "john"        // –¢–æ–ª—å–∫–æ –Ω–æ–≤–æ–µ –ø–æ–ª–µ
}
\`\`\`

#### –ü–ª—é—Å—ã Evolutionary Design

‚úÖ **–ù–µ—Ç –≤–µ—Ä—Å–∏–π** - –æ–¥–∏–Ω API –¥–ª—è –≤—Å–µ—Ö
‚úÖ **–ü–ª–∞–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –∫–ª–∏–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
‚úÖ **–ú–µ–Ω—å—à–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π

#### –ú–∏–Ω—É—Å—ã

‚ùå **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —ç–≤–æ–ª—é—Ü–∏—è** - –Ω–µ–ª—å–∑—è —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∏–∑–∞–π–Ω
‚ùå **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ legacy** - —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –≤–∏—Å—è—Ç –≤–µ—á–Ω–æ
‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å** - —Ç—Ä–µ–±—É–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –æ—Ç –∫–æ–º–∞–Ω–¥—ã

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- Internal API –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏
- API —Å –æ–¥–Ω–∏–º-–¥–≤—É–º—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –ö–æ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

| –°—Ü–µ–Ω–∞—Ä–∏–π | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|--------------|
| –ü—É–±–ª–∏—á–Ω—ã–π API | URI versioning (\`/v1/users\`) |
| Mobile/SPA | URI versioning + Integer –≤–µ—Ä—Å–∏–∏ |
| –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã | Evolutionary design –∏–ª–∏ Header versioning |
| Enterprise B2B | CalVer + –¥–æ–ª–≥–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ |
| Library/SDK | SemVer |

### 2. –í—Å–µ–≥–¥–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π—Ç–µ —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è

‚ùå **–ü–ª–æ—Ö–æ:**
\`\`\`
GET /users  # –ë–µ–∑ –≤–µ—Ä—Å–∏–∏
\`\`\`

–ü–æ—Ç–æ–º –¥–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ = breaking change.

‚úÖ **–•–æ—Ä–æ—à–æ:**
\`\`\`
GET /v1/users  # –° –≤–µ—Ä—Å–∏–µ–π —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–ª–∏–∑–∞
\`\`\`

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

–î–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
- **Changelog**: —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
- **Migration guide**: –∫–∞–∫ –ø–µ—Ä–µ–π—Ç–∏ —Å v1 –Ω–∞ v2
- **Breaking changes**: —è–≤–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å
- **Deprecated features**: —á—Ç–æ —É—Å—Ç–∞—Ä–µ–ª–æ

**–ü—Ä–∏–º–µ—Ä migration guide:**
\`\`\`markdown
# Migration from v1 to v2

## Breaking Changes
- \`user.username\` renamed to \`user.email\`
- Date format changed from \`DD-MM-YYYY\` to ISO 8601

## Steps
1. Update all \`username\` references to \`email\`
2. Parse dates as ISO 8601
3. Update base URL from \`/v1\` to \`/v2\`
\`\`\`

### 4. –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –≤–µ—Ä—Å–∏—é –≤ –æ—Ç–≤–µ—Ç–µ

**–í –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö:**
\`\`\`
HTTP/1.1 200 OK
X-API-Version: 2
\`\`\`

**–í body:**
\`\`\`json
{
  "meta": {
    "api_version": "2.0"
  },
  "data": [...]
}
\`\`\`

–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è debugging –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π

–õ–æ–≥–∏—Ä—É–π—Ç–µ –∫–∞–∫–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞–∫–∏–µ –≤–µ—Ä—Å–∏–∏:
\`\`\`javascript
app.use((req, res, next) => {
  const version = extractVersion(req);
  logger.info({ version, endpoint: req.path, user_agent: req.get('User-Agent') });
  next();
});
\`\`\`

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:
- –ü–æ–Ω—è—Ç—å –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
- –°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –Ω–∞ deprecated –≤–µ—Ä—Å–∏–∏
- –û—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏

### 6. Graceful degradation –¥–ª—è sunset

–ö–æ–≥–¥–∞ –≤–µ—Ä—Å–∏—è –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è:

**Phase 1: Warning (–∑–∞ 3 –º–µ—Å—è—Ü–∞)**
\`\`\`
HTTP/1.1 200 OK
Warning: 299 - "API v1 will be sunset on 2025-01-01"
Sunset: Sat, 01 Jan 2025 00:00:00 GMT
\`\`\`

**Phase 2: Redirect (–ø–µ—Ä–≤—ã–µ –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ sunset)**
\`\`\`
HTTP/1.1 301 Moved Permanently
Location: /v2/users
\`\`\`

**Phase 3: Gone (—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ)**
\`\`\`
HTTP/1.1 410 Gone
Content-Type: application/json

{
  "error": "API v1 is no longer supported",
  "sunset_date": "2025-01-01",
  "migration_guide": "https://docs.example.com/v2-migration"
}
\`\`\`

---

## –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏

### –ó–∞–¥–∞—á–∞ 1: URI versioning —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

\`\`\`javascript
// Express.js
const v1Router = express.Router();
const v2Router = express.Router();

v1Router.get('/users', (req, res) => {
  // v1 logic
  res.json({ username: 'john' });
});

v2Router.get('/users', (req, res) => {
  // v2 logic (renamed field)
  res.json({ email: 'john@example.com' });
});

app.use('/v1', v1Router);
app.use('/v2', v2Router);
\`\`\`

### –ó–∞–¥–∞—á–∞ 2: Header versioning

\`\`\`javascript
app.get('/users', (req, res) => {
  const accept = req.get('Accept') || '';

  if (accept.includes('vnd.myapi.v2+json')) {
    return res.json({ email: 'john@example.com' });
  }

  // Default to v1
  res.json({ username: 'john' });
});
\`\`\`

### –ó–∞–¥–∞—á–∞ 3: Deprecation headers

\`\`\`javascript
app.use('/v1', (req, res, next) => {
  res.set('Deprecation', 'Sat, 01 Jan 2025 00:00:00 GMT');
  res.set('Sunset', 'Sat, 01 Jun 2025 00:00:00 GMT');
  res.set('Link', '<https://api.example.com/v2>; rel="alternate"');
  next();
});
\`\`\`

### –ó–∞–¥–∞—á–∞ 4: Version extraction middleware

\`\`\`javascript
function extractVersion(req) {
  // URI versioning
  const uriMatch = req.path.match(/^\\/v(\\d+)\\//);
  if (uriMatch) return parseInt(uriMatch[1]);

  // Header versioning
  const headerVersion = req.get('X-API-Version');
  if (headerVersion) return parseInt(headerVersion);

  // Accept header
  const accept = req.get('Accept') || '';
  const acceptMatch = accept.match(/version=(\\d+)/);
  if (acceptMatch) return parseInt(acceptMatch[1]);

  // Default
  return 1;
}
\`\`\`

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

| –ö—Ä–∏—Ç–µ—Ä–∏–π | URI | Header | Query Param |
|----------|-----|--------|-------------|
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞** | ‚úÖ –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è |
| **RESTful** | ‚ùå –ù–µ RESTful | ‚úÖ RESTful | ‚ùå –ù–µ RESTful |
| **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ | ‚ùå –°–ª–æ–∂–Ω–æ–µ (Vary) | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ–µ |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚úÖ –õ–µ–≥–∫–æ | ‚ùå –ù—É–∂–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ | ‚úÖ –õ–µ–≥–∫–æ |
| **–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å** | ‚úÖ –û—á–µ–Ω—å –ø–æ–ø—É–ª—è—Ä–Ω–∞ | ‚ö†Ô∏è –†–µ–¥–∫–∞—è | ‚ùå –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **Use case** | –ü—É–±–ª–∏—á–Ω—ã–µ API | Enterprise/Internal | Legacy systems |

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ó–æ–ª–æ—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π—Ç–µ —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è** - \`/v1/users\` —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–ª–∏–∑–∞
2. **URI versioning –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API** - –ø—Ä–æ—Å—Ç–æ—Ç–∞ –≤–∞–∂–Ω–µ–µ –∏–¥–µ–æ–ª–æ–≥–∏–∏
3. **Breaking changes —Ä–µ–¥–∫–æ** - —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –º–∏–Ω–∏–º—É–º 2 –≤–µ—Ä—Å–∏–∏** - current + previous
5. **–û–±—ä—è–≤–ª—è–π—Ç–µ deprecation –∑–∞—Ä–∞–Ω–µ–µ** - –º–∏–Ω–∏–º—É–º 6 –º–µ—Å—è—Ü–µ–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
6. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é** - changelog + migration guide
7. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –∑–Ω–∞–π—Ç–µ –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å
8. **Graceful shutdown** - warning ‚Üí redirect ‚Üí 410 Gone

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

–ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ:
\`\`\`
GET /v1/users
\`\`\`

–ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ v2 –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã breaking changes. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ additive changes –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ. –ö–æ–≥–¥–∞ v2 –Ω–µ–∏–∑–±–µ–∂–µ–Ω - –¥–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏.

–•–æ—Ä–æ—à–µ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ = –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é.
`;

const lectureContent = cleanContent(lectureContentRaw);

async function createLecture() {
  try {
    console.log('üîß –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–∫—Ü–∏–∏ "–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API"...\n');

    const lecture = await prisma.lecture.create({
      data: {
        title: '–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API',
        topic: '–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API',
        content: lectureContent,
      },
    });

    console.log(`‚úÖ –õ–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —Å ID: ${lecture.id}\n`);

    const test = await prisma.test.findFirst({
      where: {
        title: { contains: '–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ' },
      },
      include: {
        questions: {
          include: {
            question: true,
          },
        },
      },
    });

    if (!test) {
      console.log('‚ùå –¢–µ—Å—Ç "–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API" –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }

    console.log(`üìù –ù–∞–π–¥–µ–Ω —Ç–µ—Å—Ç: ${test.title}`);
    console.log(`‚ùì –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${test.questions.length}\n`);

    const questionIds = test.questions.map((tq) => tq.questionId);

    const updateResult = await prisma.question.updateMany({
      where: {
        id: {
          in: questionIds,
        },
      },
      data: {
        lectureId: lecture.id,
      },
    });

    console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${updateResult.count}`);
    console.log(`‚úÖ –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞ "${test.title}" —Å–≤—è–∑–∞–Ω—ã —Å –ª–µ–∫—Ü–∏–µ–π!\n`);

    const verification = await prisma.question.findMany({
      where: {
        id: { in: questionIds },
        lectureId: lecture.id,
      },
    });

    console.log('üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è:');
    console.log(`   –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ—Å—Ç–µ: ${questionIds.length}`);
    console.log(`   –°–≤—è–∑–∞–Ω–æ —Å –ª–µ–∫—Ü–∏–µ–π: ${verification.length}`);
    console.log(
      `   –ü–æ–∫—Ä—ã—Ç–∏–µ: ${((verification.length / questionIds.length) * 100).toFixed(1)}%`
    );
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

createLecture();
