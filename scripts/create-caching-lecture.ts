import { PrismaClient } from '@prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';
import { Pool } from 'pg';
import dotenv from 'dotenv';

dotenv.config();

const pool = new Pool({ connectionString: process.env.DATABASE_URL });
const adapter = new PrismaPg(pool);
const prisma = new PrismaClient({ adapter });

function cleanContent(content: string): string {
  return content
    .replace(/\0/g, '')
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g, '');
}

const lectureContentRaw = `
# HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ REST API

## –í–≤–µ–¥–µ–Ω–∏–µ

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∫–æ–≥–¥–∞ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ —Å–∞–π—Ç, –±—Ä–∞—É–∑–µ—Ä –∑–∞–Ω–æ–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ª–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–µ–Ω—è–ª—Å—è 5 –ª–µ—Ç. –ê–±—Å—É—Ä–¥–Ω–∞—è —Ç—Ä–∞—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏. HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É: –±—Ä–∞—É–∑–µ—Ä—ã –∏ CDN —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∫–æ–ø–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏—Ö. –î–ª—è REST API —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –∞ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç "304 Not Modified" –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö.

## –ó–∞—á–µ–º –Ω—É–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ?

### –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫**
   - –û–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
   - –û–ø–ª–∞—Ç–∞ –∑–∞ bandwidth —Ä–∞—Å—Ç–µ—Ç
   - –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö

2. **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
   - –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å = –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ë–î
   - –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Ä–æ–≥–æ
   - –†–∏—Å–∫ overload –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ç—Ä–∞—Ñ–∏–∫–µ

3. **–ú–µ–¥–ª–µ–Ω–Ω—ã–π UX**
   - –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å (latency)
   - –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

‚úÖ **–°–Ω–∏–∂–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞** - 60-90% –∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω—ã
‚úÖ **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏** - –ë–î –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ
‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç** - –∫–µ—à –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - CDN —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É
‚úÖ **Offline support** - –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–µ—à–µ–º –±–µ–∑ —Å–µ—Ç–∏

---

## –û—Å–Ω–æ–≤–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Cache-Control (–≥–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫)

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**
\`\`\`
Cache-Control: <directive>, <directive>, ...
\`\`\`

#### –î–∏—Ä–µ–∫—Ç–∏–≤—ã –¥–ª—è response (—Å–µ—Ä–≤–µ—Ä ‚Üí –∫–ª–∏–µ–Ω—Ç)

**\`max-age=<seconds>\`** - —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∫–µ—à –≤–∞–ª–∏–¥–µ–Ω
\`\`\`
Cache-Control: max-age=3600
\`\`\`
–ö–µ—à –∞–∫—Ç—É–∞–ª–µ–Ω 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥).

**\`no-cache\`** - –º–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –Ω—É–∂–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
\`\`\`
Cache-Control: no-cache
\`\`\`
–ë—Ä–∞—É–∑–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–µ—à, –Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É—Å–ª–æ–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å (If-None-Match).

**\`no-store\`** - –≤–æ–æ–±—â–µ –Ω–µ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å
\`\`\`
Cache-Control: no-store
\`\`\`
–ù–∏–∫–∞–∫–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ. –î–ª—è sensitive –¥–∞–Ω–Ω—ã—Ö.

**\`public\`** - –º–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤ shared cache (CDN, proxy)
\`\`\`
Cache-Control: public, max-age=3600
\`\`\`

**\`private\`** - —Ç–æ–ª—å–∫–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–µ –≤ CDN/proxy
\`\`\`
Cache-Control: private, max-age=3600
\`\`\`
–î–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (dashboard –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

**\`must-revalidate\`** - –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
\`\`\`
Cache-Control: max-age=3600, must-revalidate
\`\`\`

**\`immutable\`** - —Ä–µ—Å—É—Ä—Å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è
\`\`\`
Cache-Control: public, max-age=31536000, immutable
\`\`\`
–î–ª—è —Å—Ç–∞—Ç–∏–∫–∏ —Å –≤–µ—Ä—Å–∏–µ–π –≤ URL: \`/app.js?v=1.2.3\`

**\`s-maxage=<seconds>\`** - max-age –¥–ª—è shared cache (CDN)
\`\`\`
Cache-Control: public, max-age=3600, s-maxage=86400
\`\`\`
–ë—Ä–∞—É–∑–µ—Ä –∫–µ—à–∏—Ä—É–µ—Ç –Ω–∞ 1 —á–∞—Å, CDN –Ω–∞ 24 —á–∞—Å–∞.

**\`stale-while-revalidate=<seconds>\`** - –æ—Ç–¥–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–µ—à –ø–æ–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
\`\`\`
Cache-Control: max-age=3600, stale-while-revalidate=86400
\`\`\`
–ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è 1 —á–∞—Å–∞: –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—ã–π –∫–µ—à, –æ–±–Ω–æ–≤–∏—Ç—å –≤ —Ñ–æ–Ω–µ.

#### –î–∏—Ä–µ–∫—Ç–∏–≤—ã –¥–ª—è request (–∫–ª–∏–µ–Ω—Ç ‚Üí —Å–µ—Ä–≤–µ—Ä)

**\`no-cache\`** - –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–π –∫–µ—à –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
\`\`\`
GET /users/123
Cache-Control: no-cache
\`\`\`

**\`max-age=0\`** - —Ö–æ—á—É —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
\`\`\`
Cache-Control: max-age=0
\`\`\`

---

### 2. ETag (Entity Tag)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–µ—Ä—Å–∏–∏ —Ä–µ—Å—É—Ä—Å–∞.

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ETag

**1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
\`\`\`
GET /users/123

HTTP/1.1 200 OK
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"
Cache-Control: max-age=0, must-revalidate

{
  "id": 123,
  "name": "John Doe"
}
\`\`\`

**2. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–∫–µ—à –∏—Å—Ç–µ–∫):**
\`\`\`
GET /users/123
If-None-Match: "33a64df551425fcc55e4d42a148795d9f25f89d4"
\`\`\`

**3a. –î–∞–Ω–Ω—ã–µ –ù–ï –∏–∑–º–µ–Ω–∏–ª–∏—Å—å:**
\`\`\`
HTTP/1.1 304 Not Modified
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"
\`\`\`
**–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ –ø—É—Å—Ç–æ–µ** - –∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.

**3b. –î–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å:**
\`\`\`
HTTP/1.1 200 OK
ETag: "a7f8b2c3d4e5f6789012345678901234567890ab"

{
  "id": 123,
  "name": "John Smith"  // –ò–∑–º–µ–Ω–∏–ª–æ—Å—å –∏–º—è
}
\`\`\`

#### Strong vs Weak ETag

**Strong ETag** - —Ç–æ—á–Ω–æ–µ –ø–æ–±–∞–π—Ç–æ–≤–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
\`\`\`
ETag: "686897696a7c876b7e"
\`\`\`

**Weak ETag** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–ø—Ä–µ—Ñ–∏–∫—Å \`W/\`)
\`\`\`
ETag: W/"686897696a7c876b7e"
\`\`\`

**–†–∞–∑–ª–∏—á–∏–µ:**
\`\`\`json
// –í–µ—Ä—Å–∏—è 1
{"id": 123, "name": "John", "updated_at": "2024-01-15T10:00:00Z"}

// –í–µ—Ä—Å–∏—è 2 (—Ç–æ–ª—å–∫–æ timestamp –∏–∑–º–µ–Ω–∏–ª—Å—è)
{"id": 123, "name": "John", "updated_at": "2024-01-15T10:05:00Z"}
\`\`\`

- **Strong ETag**: —Ä–∞–∑–Ω—ã–µ (–ø–æ–±–∞–π—Ç–æ–≤–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è)
- **Weak ETag**: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Weak:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã —Å timestamp
- –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ (–ø—Ä–æ–±–µ–ª—ã, –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π)

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ETag

**–í–∞—Ä–∏–∞–Ω—Ç 1: Hash —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ**
\`\`\`javascript
const crypto = require('crypto');

function generateETag(data) {
  return crypto.createHash('md5').update(JSON.stringify(data)).digest('hex');
}

const etag = generateETag({ id: 123, name: "John" });
// "5d41402abc4b2a76b9719d911017c592"
\`\`\`

**–í–∞—Ä–∏–∞–Ω—Ç 2: –í–µ—Ä—Å–∏—è –∏–∑ –ë–î**
\`\`\`javascript
const etag = \`"\${user.id}-\${user.updated_at.getTime()}"\`;
// "123-1705315200000"
\`\`\`

**–í–∞—Ä–∏–∞–Ω—Ç 3: Hash + —Å–ª–∞–±—ã–π ETag –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö**
\`\`\`javascript
const etag = \`W/"\${user.version}"\`;
// W/"42"
\`\`\`

---

### 3. Last-Modified / If-Modified-Since

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

**1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
\`\`\`
GET /users/123

HTTP/1.1 200 OK
Last-Modified: Tue, 15 Jan 2024 10:00:00 GMT
Cache-Control: max-age=0, must-revalidate

{ "id": 123, "name": "John" }
\`\`\`

**2. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å:**
\`\`\`
GET /users/123
If-Modified-Since: Tue, 15 Jan 2024 10:00:00 GMT
\`\`\`

**3a. –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
\`\`\`
HTTP/1.1 304 Not Modified
\`\`\`

**3b. –ò–∑–º–µ–Ω–∏–ª–æ—Å—å:**
\`\`\`
HTTP/1.1 200 OK
Last-Modified: Tue, 15 Jan 2024 11:30:00 GMT

{ "id": 123, "name": "Jane" }
\`\`\`

#### ETag vs Last-Modified

| –ö—Ä–∏—Ç–µ—Ä–∏–π | ETag | Last-Modified |
|----------|------|---------------|
| **–¢–æ—á–Ω–æ—Å—Ç—å** | –ü–æ–±–∞–π—Ç–æ–≤–∞—è | –°–µ–∫—É–Ω–¥–Ω–∞—è |
| **–†–∞–∑–º–µ—Ä** | –ë–æ–ª—å—à–µ | –ú–µ–Ω—å—à–µ |
| **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è** | –¢—Ä–µ–±—É–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è | –ò–∑ –ë–î timestamp |
| **–ü—Ä–æ–±–ª–µ–º—ã** | –î–æ—Ä–æ–≥–æ–π hash | –ö–æ–ª–ª–∏–∑–∏–∏ (2 –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞ —Å–µ–∫—É–Ω–¥—É) |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–æ–±–∞** –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

---

### 4. Expires (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –ê–±—Å–æ–ª—é—Ç–Ω–∞—è –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∫–µ—à–∞.

\`\`\`
Expires: Wed, 21 Oct 2025 07:28:00 GMT
\`\`\`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —á–∞—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞ (–º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º–∏)
- –ú–µ–Ω–µ–µ –≥–∏–±–∫–∏–π —á–µ–º Cache-Control

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** \`Cache-Control\` –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç \`Expires\`.

**–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞:**
\`\`\`
Cache-Control: max-age=3600
\`\`\`

---

## –£—Å–ª–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (Conditional Requests)

### If-None-Match (—Å ETag)

\`\`\`
GET /users/123
If-None-Match: "abc123"
\`\`\`

**–û—Ç–≤–µ—Ç:**
- \`304 Not Modified\` - ETag —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- \`200 OK\` - ETag –∏–∑–º–µ–Ω–∏–ª—Å—è, –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### If-Match (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)

\`\`\`
PUT /users/123
If-Match: "abc123"

{ "name": "New Name" }
\`\`\`

**–û—Ç–≤–µ—Ç:**
- \`200 OK\` / \`204 No Content\` - ETag —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- \`412 Precondition Failed\` - ETag –∏–∑–º–µ–Ω–∏–ª—Å—è, –∫—Ç–æ-—Ç–æ —É–∂–µ –æ–±–Ω–æ–≤–∏–ª

**Use case:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ lost updates (optimistic locking).

### If-Modified-Since

\`\`\`
GET /posts/456
If-Modified-Since: Tue, 15 Jan 2024 10:00:00 GMT
\`\`\`

**–û—Ç–≤–µ—Ç:**
- \`304 Not Modified\` - –Ω–µ –º–µ–Ω—è–ª—Å—è —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
- \`200 OK\` - –µ—Å—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### If-Unmodified-Since

\`\`\`
PUT /posts/456
If-Unmodified-Since: Tue, 15 Jan 2024 10:00:00 GMT
\`\`\`

**Use case:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –∞–Ω–∞–ª–æ–≥ If-Match.

---

## Vary –∑–∞–≥–æ–ª–æ–≤–æ–∫

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –ö–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –∫–µ—à.

### –ü—Ä–∏–º–µ—Ä 1: Content negotiation

\`\`\`
GET /users/123
Accept: application/json

HTTP/1.1 200 OK
Content-Type: application/json
Vary: Accept
\`\`\`

–ö–µ—à –∑–∞–≤–∏—Å–∏—Ç –æ—Ç \`Accept\`: JSON –∏ XML –≤–µ—Ä—Å–∏–∏ - —Ä–∞–∑–Ω—ã–µ –∫–µ—à –∑–∞–ø–∏—Å–∏.

### –ü—Ä–∏–º–µ—Ä 2: –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

\`\`\`
GET /products
Accept-Language: ru-RU

HTTP/1.1 200 OK
Vary: Accept-Language
\`\`\`

–†—É—Å—Å–∫–∞—è –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏–∏ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

### –ü—Ä–∏–º–µ—Ä 3: Authorization

\`\`\`
GET /dashboard
Authorization: Bearer token123

HTTP/1.1 200 OK
Cache-Control: private
Vary: Authorization
\`\`\`

–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –∫–µ—à.

### Vary: * (–Ω–µ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å)

\`\`\`
Vary: *
\`\`\`

–û–∑–Ω–∞—á–∞–µ—Ç: –∫–µ—à –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –Ω–µ –æ–ø–∏—Å—ã–≤–∞–µ–º—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ = –Ω–µ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å.

---

## –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤

### GET –∑–∞–ø—Ä–æ—Å—ã

‚úÖ **–ö–µ—à–∏—Ä—É—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** (–µ—Å–ª–∏ –µ—Å—Ç—å Cache-Control/Expires)

\`\`\`
GET /users
Cache-Control: public, max-age=60
\`\`\`

### POST –∑–∞–ø—Ä–æ—Å—ã

‚ùå **–ù–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**

–ú–æ–∂–Ω–æ —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å:
\`\`\`
POST /search
Cache-Control: public, max-age=300

{ "query": "rest api" }
\`\`\`

**Use case:** –°–ª–æ–∂–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ POST.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë—Ä–∞—É–∑–µ—Ä—ã –æ–±—ã—á–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ POST.

### PUT/DELETE/PATCH

‚ùå **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è**

–≠—Ç–æ non-safe –º–µ—Ç–æ–¥—ã, –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. No caching (–¥–ª—è sensitive –¥–∞–Ω–Ω—ã—Ö)

\`\`\`
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Expires: 0
\`\`\`

**Use case:**
- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- Real-time –¥–∞–Ω–Ω—ã–µ (–∫–æ—Ç–∏—Ä–æ–≤–∫–∏)

### 2. Cache with validation (–¥–ª—è —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö)

\`\`\`
Cache-Control: no-cache
ETag: "abc123"
\`\`\`

–ö–µ—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ **–≤—Å–µ–≥–¥–∞** –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è (304 –æ—Ç–≤–µ—Ç –±—ã—Å—Ç—Ä—ã–π).

**Use case:**
- –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- –ß–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

### 3. Short-term caching (—É–º–µ—Ä–µ–Ω–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

\`\`\`
Cache-Control: public, max-age=60
ETag: "abc123"
\`\`\`

–ö–µ—à –Ω–∞ 1 –º–∏–Ω—É—Ç—É, –ø–æ—Ç–æ–º –≤–∞–ª–∏–¥–∞—Ü–∏—è.

**Use case:**
- –°–ø–∏—Å–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
- –ù–æ–≤–æ—Å—Ç–Ω—ã–µ –ª–µ–Ω—Ç—ã
- API —Å —É–º–µ—Ä–µ–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π

### 4. Long-term caching (—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

\`\`\`
Cache-Control: public, max-age=86400
ETag: "abc123"
\`\`\`

–ö–µ—à –Ω–∞ 24 —á–∞—Å–∞.

**Use case:**
- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (—Å—Ç—Ä–∞–Ω—ã, –≤–∞–ª—é—Ç—ã)
- –ê—Ä—Ö–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –†–µ–¥–∫–æ –º–µ–Ω—è—é—â–∏–µ—Å—è —Ä–µ—Å—É—Ä—Å—ã

### 5. Immutable caching (—Å—Ç–∞—Ç–∏–∫–∞ —Å –≤–µ—Ä—Å–∏–µ–π)

\`\`\`
Cache-Control: public, max-age=31536000, immutable
\`\`\`

–ö–µ—à –Ω–∞ 1 –≥–æ–¥, **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å.

**Use case:**
- –°—Ç–∞—Ç–∏–∫–∞ —Å –≤–µ—Ä—Å–∏–µ–π: \`/app.js?v=1.2.3\`
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: \`/logo-abc123.png\`

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –º–µ–Ω—è–π—Ç–µ URL (cache busting).

### 6. Stale-while-revalidate (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è UX)

\`\`\`
Cache-Control: max-age=3600, stale-while-revalidate=86400
\`\`\`

–ü–æ—Å–ª–µ 1 —á–∞—Å–∞:
1. –í–µ—Ä–Ω—É—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–µ—à (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
2. –û–±–Ω–æ–≤–∏—Ç—å –∫–µ—à –≤ —Ñ–æ–Ω–µ
3. –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∏—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ

**Use case:**
- –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ö–æ–≥–¥–∞ UX –≤–∞–∂–Ω–µ–µ —Å–≤–µ–∂–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## CDN –∏ Shared Cache

### Private vs Public cache

**Private (—Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä):**
\`\`\`
Cache-Control: private, max-age=3600
\`\`\`

**Public (–±—Ä–∞—É–∑–µ—Ä + CDN + proxy):**
\`\`\`
Cache-Control: public, max-age=3600
\`\`\`

### s-maxage –¥–ª—è CDN

\`\`\`
Cache-Control: public, max-age=60, s-maxage=3600
\`\`\`

- –ë—Ä–∞—É–∑–µ—Ä: –∫–µ—à 1 –º–∏–Ω—É—Ç–∞
- CDN: –∫–µ—à 1 —á–∞—Å

**Use case:** –ß–∞—Å—Ç—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ CDN –º–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –¥–æ–ª—å—à–µ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏.

### Surrogate-Control (—Ç–æ–ª—å–∫–æ –¥–ª—è CDN)

\`\`\`
Surrogate-Control: max-age=3600
Cache-Control: no-cache
\`\`\`

CDN –∫–µ—à–∏—Ä—É–µ—Ç, –±—Ä–∞—É–∑–µ—Ä - –Ω–µ—Ç.

**Use case:** –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–µ—à–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ CDN.

---

## Cache Invalidation (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** "There are only two hard things in Computer Science: cache invalidation and naming things."

### 1. Time-based (TTL)

\`\`\`
Cache-Control: max-age=300
\`\`\`

–ö–µ—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.

**–ú–∏–Ω—É—Å:** –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL.

### 2. Version –≤ URL (cache busting)

\`\`\`
GET /api/v1/users?v=20240115
GET /assets/app.js?v=1.2.3
GET /logo.abc123.png
\`\`\`

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—è–π—Ç–µ –≤–µ—Ä—Å–∏—é ‚Üí –Ω–æ–≤—ã–π URL ‚Üí –Ω–æ–≤—ã–π –∫–µ—à.

**–ü–ª—é—Å—ã:**
‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
‚úÖ Immutable caching (–¥–æ–ª–≥–∏–π TTL)

**–ú–∏–Ω—É—Å—ã:**
‚ùå –ù—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ—Ä—Å–∏—è–º–∏
‚ùå –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é

### 3. Purge API (–¥–ª—è CDN)

\`\`\`
PURGE /users/123 HTTP/1.1
Host: api.example.com
X-Purge-Token: secret123
\`\`\`

–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–µ—à–∞ –∏–∑ CDN.

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
- Cloudflare: Purge API
- Fastly: Instant Purge
- AWS CloudFront: Invalidation API

### 4. Surrogate-Key (tagged cache)

\`\`\`
HTTP/1.1 200 OK
Surrogate-Key: user-123 users
\`\`\`

–ó–∞—Ç–µ–º purge –ø–æ —Ç–µ–≥—É:
\`\`\`
PURGE /
Surrogate-Key: user-123
\`\`\`

–í—Å–µ –∫–µ—à–∏ —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º —É–¥–∞–ª—è—é—Ç—Å—è.

---

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –ü—Ä–æ–±–ª–µ–º–∞

\`\`\`
GET /dashboard
Authorization: Bearer token123
\`\`\`

–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ.

### –†–µ—à–µ–Ω–∏–µ 1: Private cache

\`\`\`
Cache-Control: private, max-age=60
\`\`\`

–ö–µ—à —Ç–æ–ª—å–∫–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, CDN –Ω–µ –∫–µ—à–∏—Ä—É–µ—Ç.

### –†–µ—à–µ–Ω–∏–µ 2: Vary: Authorization

\`\`\`
Cache-Control: public, max-age=60
Vary: Authorization
\`\`\`

CDN —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–µ—à –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞.

**–ú–∏–Ω—É—Å:** –ë–µ—Å–ø–æ–ª–µ–∑–Ω–æ –µ—Å–ª–∏ –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–Ω–∏–∫–∞–ª–µ–Ω.

### –†–µ—à–µ–Ω–∏–µ 3: –†–∞–∑–¥–µ–ª–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

\`\`\`
GET /products           # Public, –∫–µ—à–∏—Ä—É–µ—Ç—Å—è
GET /users/me/cart     # Private, –Ω–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è
\`\`\`

–ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ CDN, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ - –Ω–µ—Ç.

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ó–∞–¥–∞—á–∞ 1: –ë–∞–∑–æ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å ETag

\`\`\`javascript
const crypto = require('crypto');

app.get('/users/:id', async (req, res) => {
  const user = await db.users.findById(req.params.id);

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ETag
  const etag = crypto.createHash('md5')
    .update(JSON.stringify(user))
    .digest('hex');

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ If-None-Match
  if (req.get('If-None-Match') === etag) {
    return res.status(304).end();
  }

  res.set({
    'ETag': etag,
    'Cache-Control': 'public, max-age=60'
  });

  res.json(user);
});
\`\`\`

### –ó–∞–¥–∞—á–∞ 2: Last-Modified

\`\`\`javascript
app.get('/posts/:id', async (req, res) => {
  const post = await db.posts.findById(req.params.id);

  const lastModified = post.updated_at.toUTCString();
  const ifModifiedSince = req.get('If-Modified-Since');

  if (ifModifiedSince && new Date(ifModifiedSince) >= post.updated_at) {
    return res.status(304).end();
  }

  res.set({
    'Last-Modified': lastModified,
    'Cache-Control': 'public, max-age=300'
  });

  res.json(post);
});
\`\`\`

### –ó–∞–¥–∞—á–∞ 3: Private cache –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö

\`\`\`javascript
app.get('/me/profile', authenticateUser, async (req, res) => {
  const user = await db.users.findById(req.user.id);

  res.set({
    'Cache-Control': 'private, max-age=60',
    'Vary': 'Authorization'
  });

  res.json(user);
});
\`\`\`

### –ó–∞–¥–∞—á–∞ 4: Immutable cache –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏

\`\`\`javascript
app.get('/assets/:filename', (req, res) => {
  const file = req.params.filename;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª –∏–º–µ–µ—Ç hash –≤ –∏–º–µ–Ω–∏
  if (!/\\.[a-f0-9]{8,}\\./.test(file)) {
    return res.status(400).send('Versioned URLs required');
  }

  res.set({
    'Cache-Control': 'public, max-age=31536000, immutable'
  });

  res.sendFile(file);
});
\`\`\`

### –ó–∞–¥–∞—á–∞ 5: Optimistic locking —Å If-Match

\`\`\`javascript
app.put('/posts/:id', async (req, res) => {
  const post = await db.posts.findById(req.params.id);

  const currentEtag = \`"\${post.version}"\`;
  const providedEtag = req.get('If-Match');

  if (providedEtag && providedEtag !== currentEtag) {
    return res.status(412).json({
      error: 'Precondition Failed',
      message: 'Resource was modified by another user'
    });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  post.title = req.body.title;
  post.version++;
  await post.save();

  res.set('ETag', \`"\${post.version}"\`);
  res.json(post);
});
\`\`\`

---

## Best Practices

### 1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cache-Control

–î–∞–∂–µ –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å:
\`\`\`
Cache-Control: no-store
\`\`\`

–≠—Ç–æ —è–≤–Ω–æ —Å–æ–æ–±—â–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è.

### 2. –ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ ETag + Last-Modified

\`\`\`
ETag: "abc123"
Last-Modified: Tue, 15 Jan 2024 10:00:00 GMT
Cache-Control: public, max-age=300
\`\`\`

–î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–µ—à–∞.

### 3. –†–∞–∑–ª–∏—á–∞–π—Ç–µ Public –∏ Private

**Public –¥–∞–Ω–Ω—ã–µ:**
\`\`\`
GET /products
Cache-Control: public, max-age=3600
\`\`\`

**Private –¥–∞–Ω–Ω—ã–µ:**
\`\`\`
GET /me/orders
Cache-Control: private, max-age=60
\`\`\`

### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Vary –¥–ª—è dynamic responses

\`\`\`
Vary: Accept, Accept-Language, Accept-Encoding
\`\`\`

–ù–æ –∏–∑–±–µ–≥–∞–π—Ç–µ Vary –Ω–∞ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö (fragment–∏—Ä—É–µ—Ç –∫–µ—à).

### 5. Cache busting –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏

\`\`\`
<script src="/app.abc123.js"></script>
<link href="/style.def456.css">
\`\`\`

–ó–∞—Ç–µ–º:
\`\`\`
Cache-Control: public, max-age=31536000, immutable
\`\`\`

### 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ cache hit rate

–õ–æ–≥–∏—Ä—É–π—Ç–µ:
- Cache hits (304 responses)
- Cache misses (200 responses)
- Hit rate = hits / (hits + misses)

**–¶–µ–ª—å:** 60-90% hit rate –¥–ª—è –∫–µ—à–∏—Ä—É–µ–º—ã—Ö endpoints.

### 7. CDN –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ API

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cloudflare, AWS CloudFront, Fastly –¥–ª—è:
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- DDoS –∑–∞—â–∏—Ç–∞
- –°–Ω–∏–∂–µ–Ω–∏–µ latency

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | Cache-Control | ETag | Use Case |
|-----------|---------------|------|----------|
| **No cache** | \`no-store\` | –ù–µ—Ç | Sensitive data |
| **Validate always** | \`no-cache\` | –î–∞ | –ß–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è |
| **Short TTL** | \`max-age=60\` | –î–∞ | –£–º–µ—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å |
| **Long TTL** | \`max-age=86400\` | –î–∞ | –†–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è |
| **Immutable** | \`max-age=31536000, immutable\` | –ù–µ—Ç | –°—Ç–∞—Ç–∏–∫–∞ —Å –≤–µ—Ä—Å–∏–µ–π |

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. **Cache-Control** - –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ–≥–¥–∞
2. **ETag + Last-Modified** - –¥–ª—è —Ç–æ—á–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. **304 Not Modified** - —ç–∫–æ–Ω–æ–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫ –∏ –≤—Ä–µ–º—è
4. **Public vs Private** - —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
5. **Vary** - –¥–ª—è content negotiation
6. **Cache busting** - –≤–µ—Ä—Å–∏–∏ –≤ URL –¥–ª—è immutable cache
7. **CDN** - –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã:**

- –ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (\`max-age=60\`)
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ TTL –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ cache hit rate
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CDN –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (mobile, slow network)

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ö–µ—à - —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏. –õ—É—á—à–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç, —á–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö.

–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –Ω–∞ 80-90% –∏ —É–ª—É—á—à–∏—Ç—å UX –≤ —Ä–∞–∑—ã. –ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫—É - –æ–∫—É–ø–∏—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ.
`;

const lectureContent = cleanContent(lectureContentRaw);

async function createLecture() {
  try {
    console.log('üîß –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–∫—Ü–∏–∏ "HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ"...\n');

    const lecture = await prisma.lecture.create({
      data: {
        title: 'HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ REST API',
        topic: 'HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ',
        content: lectureContent,
      },
    });

    console.log(`‚úÖ –õ–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —Å ID: ${lecture.id}\n`);

    const test = await prisma.test.findFirst({
      where: {
        title: { contains: '–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ' },
      },
      include: {
        questions: {
          include: {
            question: true,
          },
        },
      },
    });

    if (!test) {
      console.log('‚ùå –¢–µ—Å—Ç "HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ" –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }

    console.log(`üìù –ù–∞–π–¥–µ–Ω —Ç–µ—Å—Ç: ${test.title}`);
    console.log(`‚ùì –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${test.questions.length}\n`);

    const questionIds = test.questions.map((tq) => tq.questionId);

    const updateResult = await prisma.question.updateMany({
      where: {
        id: {
          in: questionIds,
        },
      },
      data: {
        lectureId: lecture.id,
      },
    });

    console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${updateResult.count}`);
    console.log(`‚úÖ –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞ "${test.title}" —Å–≤—è–∑–∞–Ω—ã —Å –ª–µ–∫—Ü–∏–µ–π!\n`);

    const verification = await prisma.question.findMany({
      where: {
        id: { in: questionIds },
        lectureId: lecture.id,
      },
    });

    console.log('üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è:');
    console.log(`   –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ—Å—Ç–µ: ${questionIds.length}`);
    console.log(`   –°–≤—è–∑–∞–Ω–æ —Å –ª–µ–∫—Ü–∏–µ–π: ${verification.length}`);
    console.log(
      `   –ü–æ–∫—Ä—ã—Ç–∏–µ: ${((verification.length / questionIds.length) * 100).toFixed(1)}%`
    );
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

createLecture();
