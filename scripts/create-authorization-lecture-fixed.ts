import { PrismaClient } from '@prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';
import { Pool } from 'pg';
import dotenv from 'dotenv';

dotenv.config();

const pool = new Pool({ connectionString: process.env.DATABASE_URL });
const adapter = new PrismaPg(pool);
const prisma = new PrismaClient({ adapter });

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
function cleanContent(content: string): string {
  return content
    .replace(/\0/g, '') // –£–±–∏—Ä–∞–µ–º null bytes
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g, ''); // –£–±–∏—Ä–∞–µ–º –¥—Ä—É–≥–∏–µ control characters –∫—Ä–æ–º–µ \n, \r, \t
}

const lectureContentRaw = `# HTTP Authorization Header: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ REST API

## –í–≤–µ–¥–µ–Ω–∏–µ: –ü—Ä–æ–ø—É—Å–∫ –Ω–∞ –∫–æ–Ω—Ü–µ—Ä—Ç

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –∏–¥–µ—Ç–µ –Ω–∞ –∫–æ–Ω—Ü–µ—Ä—Ç –≤–∞—à–µ–π –ª—é–±–∏–º–æ–π –≥—Ä—É–ø–ø—ã. –£ –≤—Ö–æ–¥–∞ –æ—Ö—Ä–∞–Ω–Ω–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞—à –±–∏–ª–µ—Ç. –≠—Ç–æ—Ç –±–∏–ª–µ—Ç ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫—É—Å–æ–∫ –±—É–º–∞–≥–∏, —ç—Ç–æ **–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤–∞—à–µ–≥–æ –ø—Ä–∞–≤–∞ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ü–µ—Ä—Ç–µ**.

–í –º–∏—Ä–µ REST API –∑–∞–≥–æ–ª–æ–≤–æ–∫ **Authorization** —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ ‚Äî —ç—Ç–æ –≤–∞—à "—Ü–∏—Ñ—Ä–æ–≤–æ–π –±–∏–ª–µ—Ç", –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç:
1. **Authentication** (–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è) ‚Äî –∫—Ç–æ –≤—ã: "–Ø ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å John"
2. **Authorization** (–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è) ‚Äî —á—Ç–æ –≤–∞–º –º–æ–∂–Ω–æ: "–Ø –º–æ–≥—É —Å–º–æ—Ç—Ä–µ—Ç—å VIP-–∑–æ–Ω—É"

–ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø—É—Å—Ç–∏—Ç –≤–∞—Å –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º!

## –ß–∞—Å—Ç—å 1: –û—Å–Ω–æ–≤—ã Authorization –∑–∞–≥–æ–ª–æ–≤–∫–∞

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization?

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞–∫ —Å–æ–æ–±—â–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—É, —á—Ç–æ –≤—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?

**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–¥–∞—Ç—å —Ç–æ–∫–µ–Ω –∏–ª–∏ credentials –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º –∑–∞–≥–æ–ª–æ–≤–∫–µ HTTP –∑–∞–ø—Ä–æ—Å–∞.

### –ë–∞–∑–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç

\`\`\`
Authorization: scheme credentials
\`\`\`

- **scheme** ‚Äî —Å—Ö–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Basic, Bearer, Digest, –∏ —Ç.–¥.)
- **credentials** ‚Äî —Å–∞–º–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω, –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∞ –Ω–µ URL –∏–ª–∏ body?

| –°–ø–æ—Å–æ–± | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –ü–æ—á–µ–º—É |
|--------|--------------|--------|
| **URL –ø–∞—Ä–∞–º–µ—Ç—Ä** | –û—á–µ–Ω—å –ø–ª–æ—Ö–æ | –ü–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞, –±—Ä–∞—É–∑–µ—Ä–∞, –ø—Ä–æ–∫—Å–∏. –ú–æ–∂–µ—Ç –±—ã—Ç—å –≤–∏–¥–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏–∏ |
| **–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞** | –°—Ä–µ–¥–Ω–µ | –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è POST/PUT, –Ω–µ –¥–ª—è GET |
| **Cookie** | –•–æ—Ä–æ—à–æ | –ü–æ–¥–≤–µ—Ä–∂–µ–Ω CSRF –∞—Ç–∞–∫–∞–º, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º |
| **Authorization –∑–∞–≥–æ–ª–æ–≤–æ–∫** | –õ—É—á—à–∏–π –≤—ã–±–æ—Ä | –ù–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ URL, —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤, —è–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å |

**–í–∞–∂–Ω–æ**: –î–∞–∂–µ Authorization –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ù–ï –±–µ–∑–æ–ø–∞—Å–µ–Ω –±–µ–∑ HTTPS! –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ TLS/SSL.

## –ß–∞—Å—Ç—å 2: –°—Ö–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 2.1. Basic Authentication

**–§–æ—Ä–º–∞—Ç**:
\`\`\`
Authorization: Basic base64(username:password)
\`\`\`

**–ü—Ä–∏–º–µ—Ä**:
\`\`\`bash
# –õ–æ–≥–∏–Ω: admin, –ü–∞—Ä–æ–ª—å: secret123
# –ö–æ–¥–∏—Ä—É–µ–º –≤ Base64: admin:secret123 -> YWRtaW46c2VjcmV0MTIz

curl -H "Authorization: Basic YWRtaW46c2VjcmV0MTIz" https://api.example.com/users
\`\`\`

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. –ö–ª–∏–µ–Ω—Ç –±–µ—Ä–µ—Ç username:password
2. –ö–æ–¥–∏—Ä—É–µ—Ç –≤ Base64
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ**:
- Base64 ‚Äî —ç—Ç–æ –ù–ï —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, —ç—Ç–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ—é–±–æ–π –º–æ–∂–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å: echo "YWRtaW46c2VjcmV0MTIz" | base64 -d -> admin:secret123
- **–ù–ò–ö–û–ì–î–ê** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Basic Auth –±–µ–∑ HTTPS!

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –ü—Ä–æ—Å—Ç—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ API
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –¢–æ–ª—å–∫–æ —Å HTTPS!

### 2.2. Bearer Token Authentication

**–§–æ—Ä–º–∞—Ç**:
\`\`\`
Authorization: Bearer token
\`\`\`

**–ü—Ä–∏–º–µ—Ä**:
\`\`\`bash
curl -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." https://api.example.com/profile
\`\`\`

**–ß—Ç–æ —Ç–∞–∫–æ–µ Bearer?**
- "Bearer" –±—É–∫–≤–∞–ª—å–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç "–ø—Ä–µ–¥—ä—è–≤–∏—Ç–µ–ª—å"
- –¢–æ–∫–µ–Ω –∫–∞–∫ –¥–µ–Ω—å–≥–∏: –∫—Ç–æ –ø—Ä–µ–¥—ä—è–≤–∏–ª ‚Äî —Ç–æ—Ç –∏ –≤–ª–∞–¥–µ–ª–µ—Ü
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–∞

**–¢–∏–ø—ã —Ç–æ–∫–µ–Ω–æ–≤**:
1. **Opaque tokens** ‚Äî —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤ –ë–î
2. **JWT (JSON Web Token)** ‚Äî —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ç–æ–∫–µ–Ω —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –ø–æ–¥–ø–∏—Å—å—é

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ REST API
- OAuth 2.0
- Single Page Applications (SPA)

### 2.3. Digest Authentication

**–§–æ—Ä–º–∞—Ç**:
\`\`\`
Authorization: Digest username="admin",
  realm="API",
  nonce="dcd98b7102dd2f0e8b11d0f600bfb0c093",
  uri="/api/users",
  response="6629fae49393a05397450978507c4ef1"
\`\`\`

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç nonce (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ)
2. –ö–ª–∏–µ–Ω—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç —Ö–µ—à MD5/SHA: MD5(username:realm:password:nonce:uri)
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ö–µ—à, –∞ –Ω–µ –ø–∞—Ä–æ–ª—å

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞–¥ Basic**:
- –ü–∞—Ä–æ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ —Å–µ—Ç–∏ (–¥–∞–∂–µ –≤ Base64)
- –ó–∞—â–∏—Ç–∞ –æ—Ç replay-–∞—Ç–∞–∫ (—á–µ—Ä–µ–∑ nonce)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- MD5 —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–ª–∞–±—ã–º
- –í—Å–µ –µ—â–µ —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è –ø–æ–ª–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –ß–∞—Å—Ç—å 3: JSON Web Token (JWT) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ

### –ß—Ç–æ —Ç–∞–∫–æ–µ JWT?

JWT ‚Äî —ç—Ç–æ **—Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞**, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ —Ç—Ä–µ—Ö —á–∞—Å—Ç–µ–π, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞–º–∏:

\`\`\`
header.payload.signature
\`\`\`

**–ü—Ä–∏–º–µ—Ä**:
\`\`\`
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
\`\`\`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT

#### 1. Header (–ó–∞–≥–æ–ª–æ–≤–æ–∫)
\`\`\`json
{
  "alg": "HS256",
  "typ": "JWT"
}
\`\`\`

#### 2. Payload (–ü–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
\`\`\`json
{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022,
  "exp": 1516242622,
  "aud": "https://api.com"
}
\`\`\`

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ claims**:
- sub ‚Äî subject (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- iss ‚Äî issuer (–∫—Ç–æ –≤—ã–¥–∞–ª)
- aud ‚Äî audience (–¥–ª—è –∫–æ–≥–æ)
- exp ‚Äî expiration time
- iat ‚Äî issued at time
- nbf ‚Äî not before (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –Ω–µ —Ä–∞–Ω—å—à–µ)

#### 3. Signature (–ü–æ–¥–ø–∏—Å—å)
\`\`\`
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)
\`\`\`

### –í–∞–ª–∏–¥–∞—Ü–∏—è JWT

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**:
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**: —Ç—Ä–∏ —á–∞—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É
2. **–ü–æ–¥–ø–∏—Å—å**: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
3. **–ê–ª–≥–æ—Ä–∏—Ç–º**: –ø—Ä–æ–≤–µ—Ä—è–µ–º alg (–∑–∞—â–∏—Ç–∞ –æ—Ç None algorithm attack)
4. **Expiration**: exp –Ω–µ –∏—Å—Ç–µ–∫
5. **Audience**: aud —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—à–µ–º—É API
6. **Issuer**: iss ‚Äî –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å JWT

**–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ sensitive –¥–∞–Ω–Ω—ã–µ**:
\`\`\`json
// –ü–õ–û–•–û
{
  "userId": "123",
  "password": "secret123",
  "creditCard": "4532..."
}
\`\`\`

**–•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã**:
\`\`\`json
// –•–û–†–û–®–û
{
  "sub": "user_123",
  "role": "admin",
  "exp": 1516242622
}
\`\`\`

**JWT –º–æ–∂–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –∫–ª—é—á–∞!** –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å payload.

## –ß–∞—Å—Ç—å 4: OAuth 2.0 –∏ —Ç–æ–∫–µ–Ω—ã

### Access Token vs Refresh Token

**Access Token**:
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫ API
- **–°—Ä–æ–∫ –∂–∏–∑–Ω–∏**: –ö–æ—Ä–æ—Ç–∫–∏–π (15 –º–∏–Ω—É—Ç - 1 —á–∞—Å)
- **–§–æ—Ä–º–∞—Ç**: Bearer token (—á–∞—Å—Ç–æ JWT)
- **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –í –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API

**Refresh Token**:
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Access Token
- **–°—Ä–æ–∫ –∂–∏–∑–Ω–∏**: –î–ª–∏–Ω–Ω—ã–π (–¥–Ω–∏, –Ω–µ–¥–µ–ª–∏, –º–µ—Å—è—Ü—ã)
- **–§–æ—Ä–º–∞—Ç**: Opaque token (—Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)
- **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –¢–æ–ª—å–∫–æ –Ω–∞ /auth/refresh endpoint

### –ó–∞—á–µ–º –¥–≤–∞ —Ç–æ–∫–µ–Ω–∞?

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ Access Token —É–∫—Ä–∞–¥—É—Ç, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ API.

**–†–µ—à–µ–Ω–∏–µ**:
1. Access Token –∂–∏–≤–µ—Ç 15 –º–∏–Ω—É—Ç ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ —É–∫—Ä–∞–¥—É—Ç, —É—â–µ—Ä–± –º–∏–Ω–∏–º–∞–ª–µ–Ω
2. Refresh Token —Ö—Ä–∞–Ω–∏—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ (httpOnly cookie, secure storage)
3. –ö–æ–≥–¥–∞ Access Token –∏—Å—Ç–µ–∫–∞–µ—Ç, –ø–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ Refresh Token

**–ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã**:
\`\`\`
1. –õ–æ–≥–∏–Ω -> –ø–æ–ª—É—á–∞–µ–º Access + Refresh —Ç–æ–∫–µ–Ω—ã
2. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å -> Authorization: Bearer access_token
3. Access –∏—Å—Ç–µ–∫ (401) -> –∑–∞–ø—Ä–æ—Å –Ω–∞ /refresh —Å Refresh Token
4. –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π Access Token
5. –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º Access Token
\`\`\`

## –ß–∞—Å—Ç—å 5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 401 Unauthorized

**–ö–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å**:
- Authorization –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å—å)
- –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ (expired)
- –§–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –æ—Ç–≤–µ—Ç–µ**:
\`\`\`
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="API", error="invalid_token"
\`\`\`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã WWW-Authenticate**:
- realm ‚Äî –∑–∞—â–∏—â–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å
- error ‚Äî –∫–æ–¥ –æ—à–∏–±–∫–∏ (invalid_token, expired_token, insufficient_scope)
- error_description ‚Äî —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä**:
\`\`\`http
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="MyAPI",
  error="invalid_token",
  error_description="The token signature is invalid"
Content-Type: application/json

{
  "error": "invalid_token",
  "message": "Token signature verification failed",
  "requestId": "req_abc123"
}
\`\`\`

### 403 Forbidden

**–†–∞–∑–Ω–∏—Ü–∞ —Å 401**:

| –°—Ç–∞—Ç—É—Å | –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|--------|----------|-------------------|
| **401 Unauthorized** | "–ö—Ç–æ —Ç—ã?" ‚Äî –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω | –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞, —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω |
| **403 Forbidden** | "–Ø –∑–Ω–∞—é –∫—Ç–æ —Ç—ã, –Ω–æ —Ç–µ–±–µ –Ω–µ–ª—å–∑—è" | –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, –Ω–æ –ø—Ä–∞–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ |

**–ü—Ä–∏–º–µ—Ä**:
\`\`\`http
HTTP/1.1 403 Forbidden
Content-Type: application/json

{
  "error": "insufficient_permissions",
  "message": "You need admin role to access this resource",
  "required_role": "admin",
  "your_role": "user"
}
\`\`\`

## –ß–∞—Å—Ç—å 6: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 6.1. –ß—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å?

**–ù–ò–ö–û–ì–î–ê –Ω–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ**:
\`\`\`javascript
// –ü–õ–û–•–û
logger.info("Request with auth: " + req.headers.authorization);
// –¢–æ–∫–µ–Ω—ã –ø–æ–ø–∞–¥—É—Ç –≤ –ª–æ–≥–∏!
\`\`\`

**–õ–æ–≥–∏—Ä—É–π—Ç–µ**:
\`\`\`javascript
// –•–û–†–û–®–û
logger.info("Auth attempt", {
  scheme: 'Bearer',
  userId: decodedToken.sub,
  success: true,
  ip: req.ip
});
\`\`\`

**–ß—Ç–æ –º–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å**:
- –°—Ö–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Basic, Bearer)
- –§–∞–∫—Ç —É—Å–ø–µ—à–Ω–æ–π/–Ω–µ—É—Å–ø–µ—à–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
- User ID (–ø–æ—Å–ª–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è)
- IP –∞–¥—Ä–µ—Å
- Request ID

### 6.2. –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤

**–†–µ–π—Ç–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**:

| –ú–µ—Ç–æ–¥ | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-------|--------|-------------|
| **Authorization header** | 9/10 | –õ—É—á—à–∏–π –≤—ã–±–æ—Ä |
| **HttpOnly Secure Cookie** | 8/10 | –•–æ—Ä–æ—à–æ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ |
| **POST body** | 5/10 | –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è GET |
| **URL –ø–∞—Ä–∞–º–µ—Ç—Ä** | 1/10 | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ |

### 6.3. HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

**–î–∞–∂–µ —Å Bearer —Ç–æ–∫–µ–Ω–∞–º–∏ –Ω—É–∂–µ–Ω HTTPS!**

–ë–µ–∑ HTTPS –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤–∏–¥–∏—Ç –≤–∞—à —Ç–æ–∫–µ–Ω –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.
–° HTTPS –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ TLS.

### 6.4. –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:

| –¢–∏–ø —Ç–æ–∫–µ–Ω–∞ | –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|------------|------------|-------------|
| **Access Token** | 15 –º–∏–Ω - 1 —á–∞—Å | –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —É—â–µ—Ä–± –ø—Ä–∏ –∫—Ä–∞–∂–µ |
| **Refresh Token** | 7-30 –¥–Ω–µ–π | –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É UX –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é |
| **API Key** | –ù–µ –∏—Å—Ç–µ–∫–∞–µ—Ç | –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–æ–∑–≤–∞–Ω –≤—Ä—É—á–Ω—É—é |

## –ß–∞—Å—Ç—å 7: –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á

### –ó–∞–¥–∞—á–∞ 1: –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏?

**–û—Ç–≤–µ—Ç**: Authorization

**–ü–æ—á–µ–º—É –Ω–µ**:
- Auth ‚Äî –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
- Bearer ‚Äî —ç—Ç–æ —Å—Ö–µ–º–∞, –∞ –Ω–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫
- Token ‚Äî –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ

### –ó–∞–¥–∞—á–∞ 2: –ü–µ—Ä–µ–¥–∞—Ç—å Bearer —Ç–æ–∫–µ–Ω

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**:
\`\`\`
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
\`\`\`

**–†–∞–∑–±–æ—Ä**:
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: Authorization
- –°—Ö–µ–º–∞: Bearer (—Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã, —Å –ø—Ä–æ–±–µ–ª–æ–º –ø–æ—Å–ª–µ)
- –¢–æ–∫–µ–Ω: —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–±–µ–ª–∞

### –ó–∞–¥–∞—á–∞ 3: –ß—Ç–æ —Ç–∞–∫–æ–µ Basic Auth?

**–û—Ç–≤–µ—Ç**: Base64 –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ username:password

**–ü—Ä–æ—Ü–µ—Å—Å**:
\`\`\`
1. –ë–µ—Ä–µ–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å: admin:secret123
2. –ö–æ–¥–∏—Ä—É–µ–º –≤ Base64: YWRtaW46c2VjcmV0MTIz
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º: Authorization: Basic YWRtaW46c2VjcmV0MTIz
\`\`\`

### –ó–∞–¥–∞—á–∞ 4: –ì–¥–µ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω?

**–û—Ç–≤–µ—Ç**: –í –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ**:
1. **Authorization header** ‚Äî –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥–∏ URL, —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤
2. **Cookie** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ —Å httpOnly, –Ω–æ –ø–æ–¥–≤–µ—Ä–∂–µ–Ω CSRF
3. **Request body** ‚Äî –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è GET
4. **URL –ø–∞—Ä–∞–º–µ—Ç—Ä** ‚Äî –ø–æ–ø–∞–¥–∞–µ—Ç –≤–µ–∑–¥–µ (–ª–æ–≥–∏, –∏—Å—Ç–æ—Ä–∏—è, analytics)

### –ó–∞–¥–∞—á–∞ 5: –ß—Ç–æ —Ç–∞–∫–æ–µ JWT?

**–û—Ç–≤–µ—Ç**: –§–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**JWT = JSON Web Token** ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç (RFC 7519) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
\`\`\`
header.payload.signature
\`\`\`

### –ó–∞–¥–∞—á–∞ 6: –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Authorization –∏ Authentication

**–û—Ç–≤–µ—Ç**: Authorization ‚Äî –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞, Authentication ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ identity

**Authentication (–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)**:
- **–í–æ–ø—Ä–æ—Å**: "–ö—Ç–æ —Ç—ã?"
- **–û—Ç–≤–µ—Ç**: "–Ø ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å John (–≤–æ—Ç –º–æ–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)"
- **–ü—Ä–∏–º–µ—Ä**: –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

**Authorization (–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)**:
- **–í–æ–ø—Ä–æ—Å**: "–ß—Ç–æ —Ç–µ–±–µ –º–æ–∂–Ω–æ?"
- **–û—Ç–≤–µ—Ç**: "–Ø –º–æ–≥—É —á–∏—Ç–∞—Ç—å, –Ω–æ –Ω–µ –º–æ–≥—É —É–¥–∞–ª—è—Ç—å"
- **–ü—Ä–∏–º–µ—Ä**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### –ó–∞–¥–∞—á–∞ 7: –ß—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –µ—Å–ª–∏ Authorization –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç?

**–û—Ç–≤–µ—Ç**: 401 Unauthorized

**–° –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º**:
\`\`\`http
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="API"
\`\`\`

### –ó–∞–¥–∞—á–∞ 8: WWW-Authenticate –∑–∞–≥–æ–ª–æ–≤–æ–∫

**–û—Ç–≤–µ—Ç**: –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ 401

**–§–æ—Ä–º–∞—Ç**:
\`\`\`
WWW-Authenticate: scheme realm="realm", param="value"
\`\`\`

**–ü—Ä–∏–º–µ—Ä—ã**:
\`\`\`http
WWW-Authenticate: Basic realm="Admin Panel"
WWW-Authenticate: Bearer realm="API", error="invalid_token"
WWW-Authenticate: Digest realm="API", nonce="abc123", algorithm=MD5
\`\`\`

### –ó–∞–¥–∞—á–∞ 9: –ë–µ–∑–æ–ø–∞—Å–Ω–∞ –ª–∏ Basic Auth –±–µ–∑ HTTPS?

**–û—Ç–≤–µ—Ç**: –ù–µ—Ç, Base64 –ª–µ–≥–∫–æ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è

**–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è**:
\`\`\`bash
# –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
Authorization: Basic YWRtaW46c2VjcmV0MTIz

# –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
$ echo "YWRtaW46c2VjcmV0MTIz" | base64 -d
admin:secret123
\`\`\`

**–í—ã–≤–æ–¥**: Basic Auth –ë–ï–ó HTTPS = –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–∫—Ä—ã—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º!

### –ó–∞–¥–∞—á–∞ 10: –ù—É–∂–Ω–æ –ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å Authorization –∑–∞–≥–æ–ª–æ–≤–∫–∏?

**–û—Ç–≤–µ—Ç**: –ù–µ—Ç, —ç—Ç–æ sensitive –¥–∞–Ω–Ω—ã–µ

**–ù–ò–ö–û–ì–î–ê**:
\`\`\`javascript
logger.info("Auth header: " + req.headers.authorization);
\`\`\`

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ**:
\`\`\`javascript
const userId = extractUserIdFromToken(req.headers.authorization);
logger.info("Auth attempt", { userId, success: true, ip: req.ip });
\`\`\`

## –ß–∞—Å—Ç—å 8: Best Practices

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS**
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Bearer + JWT –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö API**
3. **–ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Ä–æ–∫–∏ –∂–∏–∑–Ω–∏ –¥–ª—è Access Tokens** (15-60 –º–∏–Ω—É—Ç)
4. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø–æ–ª—è JWT** (signature, exp, aud, iss, –∞–ª–≥–æ—Ä–∏—Ç–º)
5. **–í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã** (401 vs 403)
6. **WWW-Authenticate –≤ 401**
7. **–ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã**

### –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å

1. **–ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ URL**
2. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ alg: "none" –≤ JWT**
3. **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ sensitive –¥–∞–Ω–Ω—ã–µ –≤ JWT payload**
4. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Basic Auth –±–µ–∑ HTTPS**
5. **–ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ exp –∏ aud**

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **Authorization –∑–∞–≥–æ–ª–æ–≤–æ–∫** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–∞—á–∏ credentials –≤ HTTP
2. **–§–æ—Ä–º–∞—Ç**: Authorization: scheme credentials
3. **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ö–µ–º—ã**:
   - **Bearer** ‚Äî –¥–ª—è JWT –∏ access tokens (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
   - **Basic** ‚Äî –¥–ª—è username:password (—Ç–æ–ª—å–∫–æ —Å HTTPS!)
   - **Digest** ‚Äî –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. **JWT** ‚Äî —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Ç–æ–∫–µ–Ω —Å –ø–æ–¥–ø–∏—Å—å—é
5. **Access + Refresh —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ UX
6. **–°—Ç–∞—Ç—É—Å—ã**: 401 ‚Äî –Ω–µ—Ç/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω, 403 ‚Äî —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω –Ω–æ –ø—Ä–∞–≤ –Ω–µ—Ç
7. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã, –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Ä–æ–∫–∏ –∂–∏–∑–Ω–∏

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–±—è

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –ª–µ–∫—Ü–∏–∏ –≤—ã –¥–æ–ª–∂–Ω—ã —É–º–µ—Ç—å:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å Bearer —Ç–æ–∫–µ–Ω—ã
- –ü–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É Basic, Bearer, Digest
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å JWT (signature, exp, aud)
- –†–∞–∑–ª–∏—á–∞—Ç—å Authentication –∏ Authorization
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã (401 vs 403)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WWW-Authenticate –≤ 401 –æ—Ç–≤–µ—Ç–∞—Ö
- –ü–æ–Ω–∏–º–∞—Ç—å –∑–∞—á–µ–º –Ω—É–∂–Ω—ã Access –∏ Refresh —Ç–æ–∫–µ–Ω—ã
- –ù–µ –¥–æ–ø—É—Å–∫–∞—Ç—å —É—Ç–µ—á–µ–∫ —Ç–æ–∫–µ–Ω–æ–≤ (–ª–æ–≥–∏, URL)

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ —Å–≤–æ–∏—Ö REST API!
`;

const lectureContent = cleanContent(lectureContentRaw);

async function createLecture() {
  try {
    console.log('üîç –ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–∞ "Authorization header"...\n');

    // –ù–∞—Ö–æ–¥–∏–º —Ç–µ—Å—Ç
    const test = await prisma.test.findFirst({
      where: {
        title: 'Authorization header',
      },
      include: {
        questions: {
          include: {
            question: true,
          },
          orderBy: {
            order: 'asc',
          },
        },
      },
    });

    if (!test) {
      console.error('‚ùå –¢–µ—Å—Ç "Authorization header" –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }

    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Å—Ç: ${test.title}`);
    console.log(`   –í–æ–ø—Ä–æ—Å–æ–≤: ${test.questions.length}\n`);

    // –°–æ–∑–¥–∞–µ–º –ª–µ–∫—Ü–∏—é
    console.log('üìù –°–æ–∑–¥–∞–µ–º –ª–µ–∫—Ü–∏—é...\n');

    const lecture = await prisma.lecture.create({
      data: {
        title: 'HTTP Authorization Header: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ',
        topic: 'Authorization',
        content: lectureContent,
      },
    });

    console.log(`‚úÖ –õ–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —Å ID: ${lecture.id}\n`);

    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞ –∫ –ª–µ–∫—Ü–∏–∏
    console.log('üîó –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∫ –ª–µ–∫—Ü–∏–∏...\n');

    const questionIds = test.questions.map((tq) => tq.questionId);

    for (const questionId of questionIds) {
      await prisma.question.update({
        where: { id: questionId },
        data: { lectureId: lecture.id },
      });
    }

    console.log(`‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω–æ ${questionIds.length} –≤–æ–ø—Ä–æ—Å–æ–≤\n`);

    console.log('üéâ –ì–æ—Ç–æ–≤–æ!\n');
    console.log(
      `üìö –õ–µ–∫—Ü–∏—è "HTTP Authorization Header: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Ç–µ—Å—Ç—É "Authorization header"`
    );
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

createLecture();
