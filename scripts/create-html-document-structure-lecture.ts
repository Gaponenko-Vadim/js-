import { PrismaClient } from '@prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';
import { Pool } from 'pg';
import dotenv from 'dotenv';
import path from 'path';

const envPath = path.resolve(__dirname, '..', '.env');
dotenv.config({ path: envPath });

const pool = new Pool({ connectionString: process.env.DATABASE_URL });
const adapter = new PrismaPg(pool);
const prisma = new PrismaClient({ adapter });

const lectureContent = `# HTML: основы и структура документа

## Введение: как чертёж дома 🏠

Представьте дом без чертежа.  
Стены есть, но непонятно, где вход, где кухня и где выход.  
HTML‑документ — это такой же **чертёж страницы**, по которому браузер понимает, что и где показывать.

💡 **Совет:** структура HTML — это порядок и смысл. Без неё даже красивый дизайн ломается.

---

## Что такое HTML

**HTML (HyperText Markup Language)** — язык разметки, который описывает структуру страницы.  
Он отвечает за то, **что** находится на странице и **как это расположено логически**.

✅ **Вывод:** HTML — это каркас. Дизайн (CSS) и логика (JS) — отдельные слои.

---

## Из чего состоит HTML‑документ

Минимальная структура всегда включает:

1) DOCTYPE — сообщает браузеру, что это HTML5  
2) HTML — корневой тег документа  
3) HEAD — метаданные (невидимые для пользователя)  
4) BODY — весь видимый контент

💡 **Совет:** если убрать любой из этих пунктов, браузер будет угадывать — а это всегда ошибки.

---

## Базовый каркас документа

~~~html
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Название страницы</title>
  </head>
  <body>
    <h1>Главный заголовок</h1>
    <p>Контент страницы</p>
  </body>
</html>
~~~

✅ **Вывод:** этот скелет — база для любых сайтов.

---

## Тег HEAD — «служебная часть»

В HEAD размещают **метаданные**, которые нужны браузеру и поисковикам:

- meta charset — кодировка (UTF‑8)  
- meta viewport — адаптивность  
- title — заголовок вкладки  
- meta description — описание страницы  
- link — подключение CSS  

💡 **Совет:** meta charset ставьте первым — это защищает от проблем с кодировкой.

✅ **Вывод:** всё, что не должно быть видно на странице, — в HEAD.

---

## Тег BODY — «видимая часть»

В BODY находится **всё, что видит пользователь**:

- тексты и заголовки  
- кнопки, формы  
- изображения  
- блоки контента  

💡 **Совет:** один главный заголовок h1 на страницу — это стандарт для структуры и SEO.

✅ **Вывод:** BODY — это сценарий, который читает пользователь.

---

## Атрибут lang — маленькая деталь с большим смыслом

HTML с lang="ru" помогает:
- скринридерам правильно озвучивать текст  
- поисковикам понимать язык страницы  
- браузеру выбирать правила переноса

✅ **Вывод:** lang — обязательный атрибут для доступности.

---

## Где подключать CSS и JS

**CSS** подключают в HEAD, чтобы страница не мигала без стилей.  
**JS** лучше подключать в конце BODY или с defer, чтобы не блокировать загрузку.

💡 **Совет:** если JS критичен, используйте defer, а не «голый» script в HEAD.

✅ **Вывод:** порядок подключения влияет на скорость и стабильность страницы.

---

## Частые ошибки

1) ❌ Нет DOCTYPE → браузер включает quirks mode  
2) ❌ Нет lang → проблемы с доступностью  
3) ❌ Нет title → вкладка без названия  
4) ❌ Скрипты блокируют загрузку страницы  
5) ❌ Метаданные в BODY → нарушение структуры

💡 **Совет:** ошибки структуры — это не «мелочи», они ломают UX и SEO.

---

## Best Practices

- Держите каркас HTML простым и читаемым  
- Всегда указывайте lang  
- Держите HEAD чистым: только метаданные  
- Не смешивайте структуру и оформление  

✅ **Вывод:** чистая структура = быстрый и понятный сайт.

---

## Заключение

HTML‑документ — это фундамент.  
Если фундамент кривой, никакой CSS не спасёт.

### Ключевые моменты

- 🎯 Структура = порядок и смысл  
- 🎯 HEAD для метаданных, BODY для контента  
- 🎯 DOCTYPE, lang, title — обязательны  
- 🎯 Чистый каркас облегчает поддержку
`;

const scenariosContent = `## Популярные сценарии

### Типичные ошибки (сводка)

- Нет DOCTYPE — браузер включает quirks mode.  
- Не указан lang — ухудшается доступность.  
- charset стоит не первым — возможна неверная кодировка.  
- Нет title/description — вкладка без смысла и хуже SEO.  
- Отсутствует viewport — мобильная версия ломается.  
- Метаданные размещены в body.  
- CSS подключён в body — виден «мигание» без стилей.  
- Скрипты в head без defer — блокируют рендер.  

---

### Сценарий 1: Нет DOCTYPE

❌ **Неправильно**: страница начинается сразу с html.  
✅ **Правильно**: первая строка — <!doctype html>.

**До:**
~~~html
<html lang="ru">
  <head></head>
  <body></body>
</html>
~~~

**После:**
~~~html
<!doctype html>
<html lang="ru">
  <head></head>
  <body></body>
</html>
~~~

**Почему**: без doctype браузер может перейти в quirks mode и сломать стили.  
**Практический пример:** DOC-01: Любая новая страница начинается с doctype.

---

### Сценарий 2: Charset не первым

❌ **Неправильно**: meta charset стоит после других тегов.  
✅ **Правильно**: charset идёт первым в head.

**До:**
~~~html
<head>
  <title>Страница</title>
  <meta charset="utf-8" />
</head>
~~~

**После:**
~~~html
<head>
  <meta charset="utf-8" />
  <title>Страница</title>
</head>
~~~

**Почему**: ранний charset защищает от проблем с кодировкой.  
**Практический пример:** DOC-02: charset — первая строка в head.

---

### Сценарий 3: Нет lang

❌ **Неправильно**: язык документа не указан.  
✅ **Правильно**: добавить lang="ru".

**До:**
~~~html
<html>
~~~

**После:**
~~~html
<html lang="ru">
~~~

**Почему**: lang нужен для доступности и правильной озвучки.  
**Практический пример:** DOC-03: lang обязателен для всех страниц.

---

### Сценарий 4: Пустой title

❌ **Неправильно**: вкладка браузера без понятного названия.  
✅ **Правильно**: title описывает страницу.

**До:**
~~~html
<title>Страница</title>
~~~

**После:**
~~~html
<title>HTML Старт — базовый курс по структуре</title>
~~~

**Почему**: title влияет на вкладку, историю и SEO.  
**Практический пример:** DOC-04: у каждой страницы свой осмысленный title.

---

### Сценарий 5: Нет viewport

❌ **Неправильно**: на телефоне страница слишком мелкая.  
✅ **Правильно**: добавить meta viewport.

**До:**
~~~html
<head>
  <meta charset="utf-8" />
</head>
~~~

**После:**
~~~html
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
~~~

**Почему**: viewport задаёт правильный масштаб на мобильных.  
**Практический пример:** DOC-05: meta viewport есть на каждой странице.

---

### Сценарий 6: Метаданные в body

❌ **Неправильно**: meta и title находятся в body.  
✅ **Правильно**: метаданные только в head.

**До:**
~~~html
<body>
  <meta charset="utf-8" />
  <title>Мой сайт</title>
</body>
~~~

**После:**
~~~html
<head>
  <meta charset="utf-8" />
  <title>Мой сайт</title>
</head>
~~~

**Почему**: body — только для видимого контента.  
**Практический пример:** DOC-06: meta/title/link всегда в head.

---

### Сценарий 7: CSS в body

❌ **Неправильно**: стили подключены после контента.  
✅ **Правильно**: link на CSS в head.

**До:**
~~~html
<body>
  ...
  <link rel="stylesheet" href="/styles/main.css" />
</body>
~~~

**После:**
~~~html
<head>
  <link rel="stylesheet" href="/styles/main.css" />
</head>
~~~

**Почему**: иначе появляется «мигание» без стилей.  
**Практический пример:** DOC-07: все CSS подключаются в head.

---

### Сценарий 8: Скрипт блокирует рендер

❌ **Неправильно**: скрипт в head без defer.  
✅ **Правильно**: использовать defer или конец body.

**До:**
~~~html
<head>
  <script src="/scripts/app.js"></script>
</head>
~~~

**После:**
~~~html
<head>
  <script src="/scripts/app.js" defer></script>
</head>
~~~

**Почему**: без defer загрузка страницы блокируется.  
**Практический пример:** DOC-08: скрипты не блокируют рендер.

---

### Сценарий 9: Контент без main и footer

❌ **Неправильно**: вся страница — набор div без структуры.  
✅ **Правильно**: выделить header, main и footer.

**До:**
~~~html
<div>
  <h1>Курс</h1>
  <p>Описание</p>
</div>
~~~

**После:**
~~~html
<header>
  <h1>Курс</h1>
</header>
<main>
  <p>Описание</p>
</main>
<footer>© 2026</footer>
~~~

**Почему**: семантическая структура упрощает навигацию и поддержку.  
**Практический пример:** DOC-09: основной контент всегда внутри main.
`;

const tasksContent = `## Подготовка к заданиям

🎯 **Цель:** собрать корректный каркас страницы и понять, где находятся метаданные и контент.  
📘 **Контекст:** делаем лендинг курса «HTML Старт».  
🧩 **Как работать:** вставьте каркас в редактор и выполняйте задания по порядку — каждое задание дополняет проект.

Каркас (правильный HTML):

~~~html
<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <!-- TODO: title -->
    <!-- TODO: description -->
    <!-- TODO: viewport -->
    <!-- TODO: styles -->
  </head>
  <body style="margin: 0; font-family: Arial, sans-serif; background: #f3f4f6;">
    <div style="min-height: 100vh; padding: 24px;">
      <div style="max-width: 960px; margin: 0 auto; background: #ffffff; border-radius: 16px; padding: 24px; box-shadow: 0 12px 30px rgba(0,0,0,0.08);">
        <!-- TODO: header -->
        <!-- TODO: main -->
        <!-- TODO: footer -->
      </div>
    </div>
    <!-- TODO: script -->
  </body>
</html>
~~~

## Задания для практики 🧪

### Задание 1: Название и описание страницы
**Кратко:**  
Ситуация: вкладка без понятного названия.  
Что сделать: добавить title и meta description.  
Критерий: title конкретный, description объясняет страницу.

**Описание:**  
🔎 **Ситуация:** у лендинга нет названия и описания, вкладка выглядит пустой.  
✅ **Что сделать:** добавить осмысленный title и meta description в head.  
📌 **Требования:**  
- title до 60 символов;  
- description 1–2 предложения;  
- оба тега находятся в head.

🧱 **Исходник (как сейчас):**
~~~html
<head>
  <meta charset="utf-8" />
  <!-- TODO: title -->
  <!-- TODO: description -->
</head>
~~~

**Ответ:**
**Было:**
~~~html
<head>
  <meta charset="utf-8" />
  <!-- TODO: title -->
  <!-- TODO: description -->
</head>
~~~

**Стало:**
~~~html
<head>
  <meta charset="utf-8" />
  <title>HTML Старт — базовый курс по структуре</title>
  <meta
    name="description"
    content="Быстрый старт по структуре HTML: каркас, head и логика страницы."
  />
</head>
~~~

**Объяснение:** title задаёт имя вкладки и помогает поиску, а description объясняет страницу в выдаче.  
Когда эти теги осмысленные, страницу легче найти и запомнить.

---

### Задание 2: Адаптивность страницы
**Кратко:**  
Ситуация: на телефоне страница выглядит слишком мелкой.  
Что сделать: добавить meta viewport.  
Критерий: есть корректный viewport в head.

**Описание:**  
🔎 **Ситуация:** без viewport браузер показывает десктопный масштаб.  
✅ **Что сделать:** добавить meta viewport после description.  
📌 **Требования:**  
- content="width=device-width, initial-scale=1";  
- тег находится в head.

🧱 **Исходник (как сейчас):**
~~~html
<head>
  <meta charset="utf-8" />
  <title>HTML Старт — базовый курс по структуре</title>
  <meta name="description" content="Быстрый старт по структуре HTML." />
  <!-- TODO: viewport -->
</head>
~~~

**Ответ:**
**Было:**
~~~html
<meta name="description" content="Быстрый старт по структуре HTML." />
<!-- TODO: viewport -->
~~~

**Стало:**
~~~html
<meta name="description" content="Быстрый старт по структуре HTML." />
<meta name="viewport" content="width=device-width, initial-scale=1" />
~~~

**Объяснение:** viewport говорит браузеру, как масштабировать страницу на мобильных.  
Без него текст и кнопки становятся слишком маленькими.

---

### Задание 3: Подключение CSS
**Кратко:**  
Ситуация: стили подключаются после контента.  
Что сделать: добавить link на CSS в head.  
Критерий: link расположен в head.

**Описание:**  
🔎 **Ситуация:** страница «мигает» без стилей при загрузке.  
✅ **Что сделать:** подключить главный CSS‑файл в head.  
📌 **Требования:**  
- использовать rel="stylesheet";  
- ссылка на /styles/main.css.

🧱 **Исходник (как сейчас):**
~~~html
<head>
  <meta charset="utf-8" />
  <title>HTML Старт — базовый курс по структуре</title>
  <meta name="description" content="Быстрый старт по структуре HTML." />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- TODO: styles -->
</head>
~~~

**Ответ:**
**Было:**
~~~html
<!-- TODO: styles -->
~~~

**Стало:**
~~~html
<link rel="stylesheet" href="/styles/main.css" />
~~~

**Объяснение:** CSS в head загружается до рендера и не вызывает «мигание».  
Это делает страницу стабильной с первого кадра.

---

### Задание 4: Шапка страницы
**Кратко:**  
Ситуация: шапка пустая.  
Что сделать: добавить header с h1 и подзаголовком.  
Критерий: есть один h1 и поясняющий текст.

**Описание:**  
🔎 **Ситуация:** пользователь не понимает, что это за курс.  
✅ **Что сделать:** собрать header с главным заголовком и коротким описанием.  
📌 **Требования:**  
- только один h1;  
- подзаголовок оформить через p.

🧱 **Исходник (как сейчас):**
~~~html
<!-- TODO: header -->
~~~

**Ответ:**
**Было:**
~~~html
<!-- TODO: header -->
~~~

**Стало:**
~~~html
<header style="margin-bottom: 20px;">
  <h1 style="margin: 0 0 6px;">HTML Старт</h1>
  <p style="margin: 0; color: #4b5563;">Понимаем структуру документа и строим каркас страницы.</p>
</header>
~~~

**Объяснение:** header показывает цель страницы и задаёт главный ориентир.  
Один h1 помогает читателю и поисковику понять тему.

---

### Задание 5: Основной контент
**Кратко:**  
Ситуация: нет содержательных блоков.  
Что сделать: добавить main с двумя секциями.  
Критерий: есть h2 и текст в каждой секции.

**Описание:**  
🔎 **Ситуация:** у курса нет структуры и разделов.  
✅ **Что сделать:** добавить main с двумя секциями «О курсе» и «Результат».  
📌 **Требования:**  
- в каждой секции есть h2 и абзац;  
- main содержит только основной контент.

🧱 **Исходник (как сейчас):**
~~~html
<!-- TODO: main -->
~~~

**Ответ:**
**Было:**
~~~html
<!-- TODO: main -->
~~~

**Стало:**
~~~html
<main>
  <section style="margin-bottom: 16px;">
    <h2 style="margin: 0 0 6px;">О курсе</h2>
    <p style="margin: 0; color: #4b5563;">Разбираем базовые элементы, head и логику HTML-документа.</p>
  </section>
  <section>
    <h2 style="margin: 0 0 6px;">Что получите</h2>
    <p style="margin: 0; color: #4b5563;">Уверенный каркас страницы и понимание структуры.</p>
  </section>
</main>
~~~

**Объяснение:** main выделяет основной контент и делает страницу логичной.  
Секции с h2 создают читабельную структуру.

---

### Задание 6: Подвал страницы
**Кратко:**  
Ситуация: странице не хватает финальной информации.  
Что сделать: добавить footer.  
Критерий: есть краткие данные о проекте.

**Описание:**  
🔎 **Ситуация:** пользователь не видит, кто сделал курс и когда.  
✅ **Что сделать:** добавить footer с копирайтом и почтой.  
📌 **Требования:**  
- краткая строка;  
- расположить в конце контейнера.

🧱 **Исходник (как сейчас):**
~~~html
<!-- TODO: footer -->
~~~

**Ответ:**
**Было:**
~~~html
<!-- TODO: footer -->
~~~

**Стало:**
~~~html
<footer style="margin-top: 24px; color: #6b7280; font-size: 14px;">
  © 2026 HTML Старт · support@htmlstart.ru
</footer>
~~~

**Объяснение:** footer завершает страницу и фиксирует служебную информацию.  
Пользователь сразу видит, кому принадлежит контент.

---

### Задание 7: Подключение скрипта без блокировки
**Кратко:**  
Ситуация: интерактивность нужна, но рендер нельзя блокировать.  
Что сделать: подключить JS с defer.  
Критерий: script стоит перед закрытием body и имеет defer.

**Описание:**  
🔎 **Ситуация:** хотим добавить интерактивность, но не мешать загрузке.  
✅ **Что сделать:** вставить script с defer.  
📌 **Требования:**  
- src="/scripts/app.js";  
- использовать defer.

🧱 **Исходник (как сейчас):**
~~~html
<!-- TODO: script -->
~~~

**Ответ:**
**Было:**
~~~html
<!-- TODO: script -->
~~~

**Стало:**
~~~html
<script src="/scripts/app.js" defer></script>
~~~

**Объяснение:** defer позволяет загружать скрипт без блокировки HTML.  
Страница отображается быстрее, а интерактивность подключается после.
`;

const exampleContent = `## Пример: базовый HTML‑документ 📄

Разрабатывается условно такой сайт: лендинг онлайн‑курса для новичков.  
После всех митингов, общения с командой и постановки задачи нужно было  
решить проблему понятной структуры страницы и быстрой загрузки.  
Ниже — полный пример корректного HTML‑каркаса.

---

~~~html
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Курс по HTML и CSS</title>
    <meta name="description" content="Быстрый старт в HTML и CSS для новичков" />
    <link rel="stylesheet" href="/styles/main.css" />
  </head>
  <body>
    <header>
      <h1>Курс по HTML и CSS</h1>
      <p>Научитесь создавать современные сайты с нуля</p>
    </header>

    <main>
      <section>
        <h2>Для кого этот курс</h2>
        <p>Для начинающих, которым нужен понятный старт</p>
      </section>

      <section>
        <h2>Что вы получите</h2>
        <ul>
          <li>Понимание структуры HTML</li>
          <li>Навыки работы с базовой семантикой</li>
          <li>Уверенность в верстке страниц</li>
        </ul>
      </section>
    </main>

    <footer>
      <p>© 2026 Мамин программист</p>
    </footer>

    <script src="/scripts/app.js" defer></script>
  </body>
</html>
~~~

💡 **Совет:** начните с чистого каркаса, и только потом добавляйте стили и логику.
`;

async function createHtmlDocumentStructureLecture() {
  try {
    console.log('🚀 Создание лекции "HTML: основы и структура документа"...\n');

    const test = await prisma.test.findFirst({
      where: { title: 'HTML: основы и структура документа' },
      include: {
        questions: {
          include: { question: true },
          orderBy: { order: 'asc' }
        }
      }
    });

    if (!test) {
      throw new Error('❌ Тест "HTML: основы и структура документа" не найден!');
    }

    await prisma.lecture.deleteMany({
      where: { title: 'HTML: основы и структура документа' }
    });

    const lecture = await prisma.lecture.create({
      data: {
        title: 'HTML: основы и структура документа',
        topic: 'HTML',
        content: lectureContent,
        scenariosContent,
        exampleContent,
        tasksContent
      }
    });

    let updatedCount = 0;
    for (const tq of test.questions) {
      await prisma.question.update({
        where: { id: tq.questionId },
        data: { lectureId: lecture.id }
      });
      updatedCount++;
    }

    console.log(`✅ Лекция создана с ID: ${lecture.id}`);
    console.log(`✅ Привязано вопросов: ${updatedCount}`);
  } catch (error) {
    console.error('❌ Ошибка:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
    await pool.end();
  }
}

createHtmlDocumentStructureLecture();


