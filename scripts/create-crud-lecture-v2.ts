import { PrismaClient } from '@prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';
import { Pool } from 'pg';
import dotenv from 'dotenv';

dotenv.config();

const pool = new Pool({ connectionString: process.env.DATABASE_URL });
const adapter = new PrismaPg(pool);
const prisma = new PrismaClient({ adapter });

function cleanContent(content: string): string {
  return content
    .replace(/\0/g, '')
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g, '');
}

const lectureContentRaw = `# CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ REST API: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –í–≤–µ–¥–µ–Ω–∏–µ: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–∞–∫ –∞–Ω–∞–ª–æ–≥–∏—è

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —á–µ—Ç—ã—Ä–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π:

1. **–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É** –≤ –∫–∞—Ç–∞–ª–æ–≥
2. **–ù–∞–π—Ç–∏ –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å** –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–∏–≥–µ
3. **–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –æ –∫–Ω–∏–≥–µ
4. **–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É** –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞

–ò–º–µ–Ω–Ω–æ —ç—Ç–∏ —á–µ—Ç—ã—Ä–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç **CRUD** ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –ª—é–±–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏!

CRUD = Create, Read, Update, Delete

–í REST API –∫–∞–∂–¥–∞—è –∏–∑ —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º HTTP –º–µ—Ç–æ–¥–∞–º.

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ CRUD?

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**CRUD** ‚Äî –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ —á–µ—Ç—ã—Ä–µ—Ö –±–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏:

| –û–ø–µ—Ä–∞—Ü–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ | HTTP –º–µ—Ç–æ–¥ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|------------|--------|
| **C**reate | –°–æ–∑–¥–∞—Ç—å | POST | –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **R**ead | –ü—Ä–æ—á–∏—Ç–∞—Ç—å | GET | –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **U**pdate | –û–±–Ω–æ–≤–∏—Ç—å | PUT, PATCH | –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **D**elete | –£–¥–∞–ª–∏—Ç—å | DELETE | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

**–ó–∞—á–µ–º CRUD?**
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- –ü–æ–Ω—è—Ç–µ–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö
- –ü–æ–∫—Ä—ã–≤–∞–µ—Ç 90% –æ–ø–µ—Ä–∞—Ü–∏–π –ª—é–±–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç HTTP —Å–µ–º–∞–Ω—Ç–∏–∫–µ

---

## CREATE (–°–æ–∑–¥–∞–Ω–∏–µ) ‚Äî POST

### –û–ø–∏—Å–∞–Ω–∏–µ

**Create** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

**HTTP –º–µ—Ç–æ–¥**: POST

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–ø–∏—Å–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- –õ—é–±–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, —Å–æ–∑–¥–∞—é—â–∞—è –Ω–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å

### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ó–∞–ø—Ä–æ—Å:
POST /users HTTP/1.1
Content-Type: application/json

{
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "email": "ivan@example.com",
  "age": 28
}

–û—Ç–≤–µ—Ç:
HTTP/1.1 201 Created
Location: /users/123
Content-Type: application/json

{
  "id": "123",
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "email": "ivan@example.com",
  "age": 28,
  "createdAt": "2024-01-08T12:00:00Z"
}

### –°—Ç–∞—Ç—É—Å—ã –æ—Ç–≤–µ—Ç–∞ –¥–ª—è POST

**201 Created** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
- –†–µ—Å—É—Ä—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω
- –í–∫–ª—é—á–∏—Ç–µ Location –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å URL –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
- –í–µ—Ä–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å –≤ —Ç–µ–ª–µ

**200 OK** (–¥–æ–ø—É—Å—Ç–∏–º–æ):
- –†–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞–Ω, –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

**202 Accepted** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏):
- –ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç, –Ω–æ —Ä–µ—Å—É—Ä—Å –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω

### Location –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏ 201 Created

**–í–æ–ø—Ä–æ—Å**: –ù—É–∂–Ω–æ –ª–∏ –≤–∫–ª—é—á–∞—Ç—å Location?

**–û—Ç–≤–µ—Ç**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!

Location —É–∫–∞–∑—ã–≤–∞–µ—Ç URL —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—É —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–º—É.

–ü—Ä–∏–º–µ—Ä:
HTTP/1.1 201 Created
Location: /users/123

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ POST

POST –ù–ï –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω:
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π POST —Å–æ–∑–¥–∞—Å—Ç –¥—É–±–ª–∏–∫–∞—Ç —Ä–µ—Å—É—Ä—Å–∞

POST –ù–ï –±–µ–∑–æ–ø–∞—Å–µ–Ω (not safe):
- –ò–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞

---

## READ (–ß—Ç–µ–Ω–∏–µ) ‚Äî GET

### –û–ø–∏—Å–∞–Ω–∏–µ

**Read** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ **–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è** —Å–æ—Å—Ç–æ—è–Ω–∏—è.

**HTTP –º–µ—Ç–æ–¥**: GET

### –ö–∞–∫–∞—è CRUD –æ–ø–µ—Ä–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç GET?

**–û—Ç–≤–µ—Ç**: Read

GET –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### –î–æ–ª–∂–µ–Ω –ª–∏ GET –∏–∑–º–µ–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞?

**–û—Ç–≤–µ—Ç**: –ù–µ—Ç, GET –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º (safe)

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ**:

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: GET –∑–∞–ø—Ä–æ—Å—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–∞–º–∏ –∏ CDN
2. **Prefetching**: –ë—Ä–∞—É–∑–µ—Ä—ã –º–æ–≥—É—Ç –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—Ç—å GET —Å—Å—ã–ª–∫–∏
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: GET –≤ –ª–æ–≥–∞—Ö, –∏—Å—Ç–æ—Ä–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–µ–Ω

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ**:
GET /users/123/delete
GET /cart/add?item=5

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ**:
DELETE /users/123
POST /cart/items

### –ü—Ä–∏–º–µ—Ä—ã GET –∑–∞–ø—Ä–æ—Å–æ–≤

–û–¥–∏–Ω —Ä–µ—Å—É—Ä—Å:
GET /users/123 HTTP/1.1

HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": "123",
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "email": "ivan@example.com"
}

–°–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤:
GET /users HTTP/1.1

HTTP/1.1 200 OK
Content-Type: application/json

{
  "data": [
    {"id": "1", "name": "–ò–≤–∞–Ω"},
    {"id": "2", "name": "–ú–∞—Ä–∏—è"}
  ],
  "total": 2,
  "page": 1
}

–†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω:
GET /users/999

HTTP/1.1 404 Not Found
Content-Type: application/json

{
  "error": "User not found",
  "userId": "999"
}

---

## UPDATE (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ) ‚Äî PUT –∏ PATCH

### –ö–∞–∫–∏–µ HTTP –º–µ—Ç–æ–¥—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç Update?

**–û—Ç–≤–µ—Ç**: PUT –∏ PATCH

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É PUT –∏ PATCH

**PUT** ‚Äî –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Ä–µ—Å—É—Ä—Å–∞
**PATCH** ‚Äî —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

| –ö—Ä–∏—Ç–µ—Ä–∏–π | PUT | PATCH |
|----------|-----|-------|
| **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç** | –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ | –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è** | –í—Å–µ | –¢–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ–º—ã–µ |
| **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | –î–∞ | –ó–∞–≤–∏—Å–∏—Ç |

### PUT ‚Äî –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞

**–ü—Ä–∏–º–µ—Ä**:

PUT /users/123 HTTP/1.1
Content-Type: application/json

{
  "name": "–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤",
  "email": "ivan.new@example.com",
  "age": 29
}

HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": "123",
  "name": "–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤",
  "email": "ivan.new@example.com",
  "age": 29,
  "updatedAt": "2024-01-08T16:00:00Z"
}

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å PUT –∑–∞–ø—Ä–æ—Å–∞

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å PUT?

**–û—Ç–≤–µ—Ç**: –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ PUT –¥–∞—é—Ç —Ç–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç —á—Ç–æ –∏ –æ–¥–∏–Ω

–ü–µ—Ä–≤—ã–π PUT:
PUT /users/123
{"name": "Ivan"}

–†–µ–∑—É–ª—å—Ç–∞—Ç: name = Ivan

–í—Ç–æ—Ä–æ–π –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π PUT:
PUT /users/123
{"name": "Ivan"}

–†–µ–∑—É–ª—å—Ç–∞—Ç: name = Ivan (–¢–û –ñ–ï!)

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PUT –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è?

**–û—Ç–≤–µ—Ç**: –î–∞, –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç ID

–ü—Ä–∏–º–µ—Ä (UPSERT):
PUT /users/my-custom-id-123 HTTP/1.1
Content-Type: application/json

{
  "name": "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
  "email": "new@example.com"
}

–ï—Å–ª–∏ —Ä–µ—Å—É—Ä—Å–∞ –ù–ï–¢:
HTTP/1.1 201 Created
Location: /users/my-custom-id-123

–ï—Å–ª–∏ —Ä–µ—Å—É—Ä—Å –°–£–©–ï–°–¢–í–£–ï–¢:
HTTP/1.1 200 OK

### –î–æ–ª–∂–µ–Ω –ª–∏ PUT –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ª—è?

**–û—Ç–≤–µ—Ç**: –î–∞

PUT –∑–∞–º–µ–Ω—è–µ—Ç —Ä–µ—Å—É—Ä—Å —Ü–µ–ª–∏–∫–æ–º, –ø–æ—ç—Ç–æ–º—É –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
PUT /users/123
{
  "name": "Ivan"
}

HTTP/1.1 400 Bad Request
{
  "error": "Missing required field: email"
}

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:
PUT /users/123
{
  "name": "Ivan",
  "email": "ivan@example.com",
  "age": 28
}

HTTP/1.1 200 OK

### PATCH ‚Äî –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä**:

PATCH /users/123 HTTP/1.1
Content-Type: application/json

{
  "email": "ivan.new@example.com"
}

HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": "123",
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "email": "ivan.new@example.com",
  "age": 28,
  "updatedAt": "2024-01-08T16:30:00Z"
}

–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ email, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### PATCH —Å –ø—É—Å—Ç—ã–º —Ç–µ–ª–æ–º

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–∏ PATCH —Å –ø—É—Å—Ç—ã–º —Ç–µ–ª–æ–º?

**–û—Ç–≤–µ—Ç**: 400 Bad Request

PATCH /users/123
{}

HTTP/1.1 400 Bad Request
{
  "error": "PATCH body must contain at least one field to update"
}

–ü—É—Å—Ç–æ–π PATCH –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ ‚Äî –Ω–µ—á–µ–≥–æ –æ–±–Ω–æ–≤–ª—è—Ç—å!

### JSON Patch (RFC 6902)

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ —Ç–∞–∫–æ–µ JSON Patch?

**–û—Ç–≤–µ—Ç**: –§–æ—Ä–º–∞—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π JSON –¥–æ–∫—É–º–µ–Ω—Ç–∞

**Content-Type**: application/json-patch+json

**–ü—Ä–∏–º–µ—Ä**:

PATCH /users/123 HTTP/1.1
Content-Type: application/json-patch+json

[
  {"op": "replace", "path": "/email", "value": "new@example.com"},
  {"op": "add", "path": "/phone", "value": "+7-999-123-45-67"},
  {"op": "remove", "path": "/temporary"}
]

**–û–ø–µ—Ä–∞—Ü–∏–∏**:
- add ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ
- remove ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ
- replace ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
- move ‚Äî –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
- copy ‚Äî —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
- test ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ

---

## DELETE (–£–¥–∞–ª–µ–Ω–∏–µ)

### –û–ø–∏—Å–∞–Ω–∏–µ

**Delete** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞.

**HTTP –º–µ—Ç–æ–¥**: DELETE

### –ü—Ä–∏–º–µ—Ä

DELETE /users/123 HTTP/1.1

HTTP/1.1 204 No Content

### –ß—Ç–æ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å DELETE —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞?

**–û—Ç–≤–µ—Ç**: –õ—é–±–æ–π –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö:

**204 No Content** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
DELETE /users/123

HTTP/1.1 204 No Content

**200 OK** (—Å —Ç–µ–ª–æ–º):
DELETE /users/123

HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": "123",
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "deletedAt": "2024-01-08T17:00:00Z"
}

**202 Accepted** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ):
DELETE /users/123

HTTP/1.1 202 Accepted
Content-Type: application/json

{
  "message": "Deletion scheduled",
  "jobId": "del-789"
}

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–π DELETE

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º DELETE —É–∂–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞?

**–û—Ç–≤–µ—Ç**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–í–∞—Ä–∏–∞–Ω—Ç 1: 404 Not Found**
DELETE /users/123

HTTP/1.1 404 Not Found
{
  "error": "User not found"
}

**–í–∞—Ä–∏–∞–Ω—Ç 2: 204 No Content (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥)**
DELETE /users/123

HTTP/1.1 204 No Content

**–í–∞—Ä–∏–∞–Ω—Ç 3: 410 Gone**
DELETE /users/123

HTTP/1.1 410 Gone
{
  "deletedAt": "2024-01-07T10:00:00Z"
}

–í—Å–µ —Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã!

### –î–æ–ª–∂–µ–Ω –ª–∏ DELETE –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å?

**–û—Ç–≤–µ—Ç**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

–í—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π API:
- **204 No Content**: –º–∏–Ω–∏–º–∞–ª–∏–∑–º, —ç–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞
- **200 OK —Å —Ç–µ–ª–æ–º**: –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å undo

### Soft Delete

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ —Ç–∞–∫–æ–µ soft delete?

**–û—Ç–≤–µ—Ç**: –ü–æ–º–µ—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–π –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –ë–î

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

DELETE /users/123

–°–µ—Ä–≤–µ—Ä –ù–ï —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å, –∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥:
UPDATE users SET deleted_at = NOW() WHERE id = 123

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ê—É–¥–∏—Ç –∏ –∏—Å—Ç–æ—Ä–∏—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–µ–π —Å –¥—Ä—É–≥–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**GET –ø–æ—Å–ª–µ soft delete**:

GET /users/123

HTTP/1.1 404 Not Found
{
  "error": "User was deleted",
  "deletedAt": "2024-01-08T17:00:00Z"
}

---

## UPSERT (Update or Insert)

### –ß—Ç–æ —Ç–∞–∫–æ–µ upsert?

**–û—Ç–≤–µ—Ç**: Update –∏–ª–∏ Insert

–û–ø–µ—Ä–∞—Ü–∏—è –∫–æ—Ç–æ—Ä–∞—è:
- **–°–æ–∑–¥–∞–µ—Ç** —Ä–µ—Å—É—Ä—Å, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- **–û–±–Ω–æ–≤–ª—è–µ—Ç** —Ä–µ—Å—É—Ä—Å, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –ö–∞–∫–æ–π HTTP –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

**–û—Ç–≤–µ—Ç**: PUT

**–ü—Ä–∏–º–µ—Ä**:

PUT /users/my-custom-id-123 HTTP/1.1
Content-Type: application/json

{
  "name": "Ivan",
  "email": "ivan@example.com"
}

–ï—Å–ª–∏ —Ä–µ—Å—É—Ä—Å–∞ –ù–ï–¢:
HTTP/1.1 201 Created
Location: /users/my-custom-id-123

–ï—Å–ª–∏ —Ä–µ—Å—É—Ä—Å –°–£–©–ï–°–¢–í–£–ï–¢:
HTTP/1.1 200 OK

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏
- –ö–ª–∏–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ID (UUID, slug)
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞

---

## –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å POST –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?

**–û—Ç–≤–µ—Ç**: –î–∞, –Ω–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

POST —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

POST /users/123/update
{"name": "New Name"}

**–ù–æ —ç—Ç–æ –ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞!**

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ**:
PUT /users/123 –∏–ª–∏ PATCH /users/123

**–ü–æ—á–µ–º—É POST –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Update**:
- –ù–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω
- –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç REST —Å–µ–º–∞–Ω—Ç–∏–∫–µ
- –ú–µ–Ω–µ–µ –ø–æ–Ω—è—Ç–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

## –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

### –ß—Ç–æ —Ç–∞–∫–æ–µ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞?

**–û—Ç–≤–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Ä–µ—Å—É—Ä—Å–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A —á–∏—Ç–∞–µ—Ç —Å—Ç–∞—Ç—å—é (–≤–µ—Ä—Å–∏—è 5)
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B —á–∏—Ç–∞–µ—Ç —Å—Ç–∞—Ç—å—é (–≤–µ—Ä—Å–∏—è 5)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –æ–±–Ω–æ–≤–ª—è–µ—Ç (–≤–µ—Ä—Å–∏—è -> 6)
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –æ–±–Ω–æ–≤–ª—è–µ—Ç (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è A!)

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–µ—Ä—Å–∏—é –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### –ö–∞–∫–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

**–û—Ç–≤–µ—Ç**: If-Match

**–ü—Ä–∏–º–µ—Ä**:

–®–∞–≥ 1 - –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å:
GET /articles/123

HTTP/1.1 200 OK
ETag: "version-5"

{
  "id": "123",
  "title": "–°—Ç–∞—Ä—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫",
  "version": 5
}

–®–∞–≥ 2 - –û–±–Ω–æ–≤–∏—Ç—å —Å —É—Å–ª–æ–≤–∏–µ–º:
PUT /articles/123 HTTP/1.1
If-Match: "version-5"
Content-Type: application/json

{
  "title": "–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫",
  "version": 6
}

–ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç:
HTTP/1.1 200 OK
ETag: "version-6"

–ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –ù–ï —Å–æ–≤–ø–∞–¥–∞–µ—Ç:
HTTP/1.1 412 Precondition Failed
{
  "error": "Resource was modified by another user"
}

### –ß—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –µ—Å–ª–∏ If-Match –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç?

**–û—Ç–≤–µ—Ç**: 412 Precondition Failed

PUT /articles/123
If-Match: "version-5"

HTTP/1.1 412 Precondition Failed
Content-Type: application/json

{
  "error": "Resource was modified",
  "currentVersion": 7,
  "yourVersion": 5
}

---

## –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ POST

### –î–æ–ª–∂–µ–Ω –ª–∏ POST –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º?

**–û—Ç–≤–µ—Ç**: –ù–µ—Ç

POST –ø–æ —Å–≤–æ–µ–π –ø—Ä–∏—Ä–æ–¥–µ –ù–ï –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω ‚Äî –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å.

### –ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã?

**–û—Ç–≤–µ—Ç**: –í—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ

**1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**:

const existing = await db.orders.findOne({
  userId: req.user.id,
  items: req.body.items,
  createdAt: { $gt: Date.now() - 60000 }
});

if (existing) {
  return res.status(409).json({
    error: "Duplicate order",
    existingOrderId: existing.id
  });
}

**2. Idempotency-Key –∑–∞–≥–æ–ª–æ–≤–æ–∫**:

POST /orders HTTP/1.1
Idempotency-Key: unique-key-abc-123

{
  "items": [{"product": "book"}],
  "total": 500
}

–°–µ—Ä–≤–µ—Ä –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–ª—é—á –∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**3. UUID –≤ –∑–∞–ø—Ä–æ—Å–µ**:

POST /orders HTTP/1.1
{
  "clientRequestId": "uuid-generated-by-client",
  "items": [...]
}

–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç clientRequestId –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º.

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ CRUD

| –û–ø–µ—Ä–∞—Ü–∏—è | HTTP –º–µ—Ç–æ–¥ | –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω | Safe | –£—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ç—É—Å |
|----------|------------|--------------|------|-----------------|
| **Create** | POST | –ù–µ—Ç | –ù–µ—Ç | 201 Created |
| **Read** | GET | –î–∞ | –î–∞ | 200 OK |
| **Update (–ø–æ–ª–Ω–æ–µ)** | PUT | –î–∞ | –ù–µ—Ç | 200 OK / 204 |
| **Update (—á–∞—Å—Ç–∏—á–Ω–æ–µ)** | PATCH | –ó–∞–≤–∏—Å–∏—Ç | –ù–µ—Ç | 200 OK |
| **Delete** | DELETE | –î–∞ | –ù–µ—Ç | 204 / 200 / 202 |

---

## –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á

### –ó–∞–¥–∞—á–∞ 1: –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç CRUD?

**–û—Ç–≤–µ—Ç**: Create, Read, Update, Delete

### –ó–∞–¥–∞—á–∞ 2: GET —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–∞–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏?

**–û—Ç–≤–µ—Ç**: Read

### –ó–∞–¥–∞—á–∞ 3: –ú–µ—Ç–æ–¥—ã –¥–ª—è Update?

**–û—Ç–≤–µ—Ç**: PUT –∏ PATCH

### –ó–∞–¥–∞—á–∞ 4: GET –∏–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ?

**–û—Ç–≤–µ—Ç**: –ù–µ—Ç, GET –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º

### –ó–∞–¥–∞—á–∞ 5: –ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?

**–û—Ç–≤–µ—Ç**: POST /users

### –ó–∞–¥–∞—á–∞ 6: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å PUT?

**–û—Ç–≤–µ—Ç**: –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ PUT –¥–∞—é—Ç —Ç–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç

### –ó–∞–¥–∞—á–∞ 7: PUT vs PATCH?

**–û—Ç–≤–µ—Ç**: PUT - –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞, PATCH - —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ó–∞–¥–∞—á–∞ 8: PUT –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è?

**–û—Ç–≤–µ—Ç**: –î–∞, –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç ID

### –ó–∞–¥–∞—á–∞ 9: –°—Ç–∞—Ç—É—Å—ã —É—Å–ø–µ—à–Ω–æ–≥–æ DELETE?

**–û—Ç–≤–µ—Ç**: 200 OK, 204 No Content, 202 Accepted

### –ó–∞–¥–∞—á–∞ 10: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π DELETE?

**–û—Ç–≤–µ—Ç**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ó–∞–¥–∞—á–∞ 11: Location –ø—Ä–∏ 201?

**–û—Ç–≤–µ—Ç**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

### –ó–∞–¥–∞—á–∞ 12: –ß—Ç–æ —Ç–∞–∫–æ–µ upsert?

**–û—Ç–≤–µ—Ç**: Update –∏–ª–∏ Insert

### –ó–∞–¥–∞—á–∞ 13: –ú–µ—Ç–æ–¥ –¥–ª—è upsert?

**–û—Ç–≤–µ—Ç**: PUT

### –ó–∞–¥–∞—á–∞ 14: POST –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?

**–û—Ç–≤–µ—Ç**: –î–∞, –Ω–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

### –ó–∞–¥–∞—á–∞ 15: PATCH —Å –ø—É—Å—Ç—ã–º —Ç–µ–ª–æ–º?

**–û—Ç–≤–µ—Ç**: 400 Bad Request

### –ó–∞–¥–∞—á–∞ 16: PUT –≤–∞–ª–∏–¥–∞—Ü–∏—è?

**–û—Ç–≤–µ—Ç**: –î–∞, –≤—Å–µ—Ö –ø–æ–ª–µ–π —Ä–µ—Å—É—Ä—Å–∞

### –ó–∞–¥–∞—á–∞ 17: –ß—Ç–æ —Ç–∞–∫–æ–µ JSON Patch?

**–û—Ç–≤–µ—Ç**: –§–æ—Ä–º–∞—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π JSON –¥–æ–∫—É–º–µ–Ω—Ç–∞

### –ó–∞–¥–∞—á–∞ 18: Content-Type JSON Patch?

**–û—Ç–≤–µ—Ç**: application/json-patch+json

### –ó–∞–¥–∞—á–∞ 19: –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞?

**–û—Ç–≤–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ —Ä–µ—Å—É—Ä—Å–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### –ó–∞–¥–∞—á–∞ 20: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É—Å–ª–æ–≤–Ω–æ–≥–æ PUT?

**–û—Ç–≤–µ—Ç**: If-Match

### –ó–∞–¥–∞—á–∞ 21: If-Match –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç?

**–û—Ç–≤–µ—Ç**: 412 Precondition Failed

### –ó–∞–¥–∞—á–∞ 22: POST –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω?

**–û—Ç–≤–µ—Ç**: –ù–µ—Ç

### –ó–∞–¥–∞—á–∞ 23: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ POST?

**–û—Ç–≤–µ—Ç**: –í—Å–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞, Idempotency-Key, UUID)

### –ó–∞–¥–∞—á–∞ 24: Soft delete?

**–û—Ç–≤–µ—Ç**: –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–π –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

### –ó–∞–¥–∞—á–∞ 25: DELETE –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ—Å—É—Ä—Å–∞?

**–û—Ç–≤–µ—Ç**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

---

## Best Practices

### CREATE (POST)
- –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ 201 Created —Å Location
- –í–∫–ª—é—á–∞–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å –≤ —Ç–µ–ª–æ
- –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Idempotency-Key –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### READ (GET)
- GET –ù–ï –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ (safe)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ 404 –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–∞–≥–∏–Ω–∞—Ü–∏—é

### UPDATE (PUT/PATCH)
- PUT –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–º–µ–Ω—ã
- PATCH –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø–æ–ª—è –≤ PUT
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ If-Match –¥–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### DELETE
- –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ 204 No Content (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ soft delete –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π DELETE –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **CRUD** = Create, Read, Update, Delete ‚Äî –æ—Å–Ω–æ–≤–∞ –ª—é–±–æ–≥–æ API
2. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ HTTP –º–µ—Ç–æ–¥–∞–º**: POST (Create), GET (Read), PUT/PATCH (Update), DELETE
3. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: PUT, DELETE, GET (–Ω–æ –Ω–µ POST!)
4. **Safe –º–µ—Ç–æ–¥—ã**: —Ç–æ–ª—å–∫–æ GET
5. **PUT vs PATCH**: –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ vs —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
6. **Upsert**: PUT —Å client-generated ID
7. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: If-Match + ETag
8. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: Idempotency-Key, –ø—Ä–æ–≤–µ—Ä–∫–∞, UUID

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–±—è

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –≤—ã –¥–æ–ª–∂–Ω—ã —É–º–µ—Ç—å:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å HTTP –º–µ—Ç–æ–¥ –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ü–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É PUT –∏ PATCH
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã POST
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å DELETE
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥—Ä–∞–º–æ—Ç–Ω—ã–µ CRUD API! üéâ
`;

const lectureContent = cleanContent(lectureContentRaw);

async function createLecture() {
  try {
    console.log('üîç –ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–∞ "CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–µ—Ç–∞–ª—å–Ω–æ"...\n');

    const test = await prisma.test.findFirst({
      where: {
        title: { contains: 'CRUD' },
      },
      include: {
        questions: {
          include: {
            question: true,
          },
          orderBy: {
            order: 'asc',
          },
        },
      },
    });

    if (!test) {
      console.error('‚ùå –¢–µ—Å—Ç "CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–µ—Ç–∞–ª—å–Ω–æ" –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }

    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Å—Ç: ${test.title}`);
    console.log(`   –í–æ–ø—Ä–æ—Å–æ–≤: ${test.questions.length}\n`);

    console.log('üìù –°–æ–∑–¥–∞–µ–º –ª–µ–∫—Ü–∏—é...\n');

    const lecture = await prisma.lecture.create({
      data: {
        title: 'CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ REST API: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ',
        topic: 'CRUD',
        content: lectureContent,
      },
    });

    console.log(`‚úÖ –õ–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —Å ID: ${lecture.id}\n`);

    console.log('üîó –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∫ –ª–µ–∫—Ü–∏–∏...\n');

    const questionIds = test.questions.map((tq) => tq.questionId);

    for (const questionId of questionIds) {
      await prisma.question.update({
        where: { id: questionId },
        data: { lectureId: lecture.id },
      });
    }

    console.log(`‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω–æ ${questionIds.length} –≤–æ–ø—Ä–æ—Å–æ–≤\n`);

    console.log('üéâ –ì–æ—Ç–æ–≤–æ!\n');
    console.log(
      `üìö –õ–µ–∫—Ü–∏—è "CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ REST API: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Ç–µ—Å—Ç—É "${test.title}"`
    );
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

createLecture();
